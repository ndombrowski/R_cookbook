{
  "hash": "c49f411788ac0fe238f0e746dcb46957",
  "result": {
    "markdown": "---\nexecute:\n    eval: true\n\ndf-print: paged\n---\n\n\n\n# Working with annotation data\n\nAs mentioned in the beginning section, if working with genomes we often have large lists of proteins and their annotations, often from different databases.\n\nHere, we might be interested in condensing this information for each genome or for each phylum etc . OR we want to merge our data with other tables that are ordered differently. \nWe might also want to plot the data to compare the presence absence levels of different genomes. This section with discuss how to do this in a step by step manner.\n\n\n## Load essential packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# | warning: false\n\nlibrary(\"ggplot2\")\nlibrary(\"plyr\")\nlibrary(\"dplyr\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:plyr':\n\n    arrange, count, desc, failwith, id, mutate, rename, summarise,\n    summarize\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(\"grid\")\nlibrary(\"gplots\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gplots'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:stats':\n\n    lowess\n```\n:::\n\n```{.r .cell-code}\nlibrary(\"gridExtra\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gridExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n:::\n\n```{.r .cell-code}\nlibrary(\"multcomp\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: mvtnorm\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: survival\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: TH.data\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: MASS\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'MASS'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'TH.data'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:MASS':\n\n    geyser\n```\n:::\n\n```{.r .cell-code}\nlibrary(\"reshape2\")\nlibrary(\"RColorBrewer\")\nlibrary('tidyr')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tidyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:reshape2':\n\n    smiths\n```\n:::\n\n```{.r .cell-code}\nlibrary('tidyverse')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching packages --------------------------------------- tidyverse 1.3.2 --\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nv tibble  3.1.8     v stringr 1.4.1\nv readr   2.1.2     v forcats 0.5.2\nv purrr   0.3.4     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::arrange()     masks plyr::arrange()\nx gridExtra::combine() masks dplyr::combine()\nx purrr::compact()     masks plyr::compact()\nx dplyr::count()       masks plyr::count()\nx dplyr::failwith()    masks plyr::failwith()\nx dplyr::filter()      masks stats::filter()\nx dplyr::id()          masks plyr::id()\nx dplyr::lag()         masks stats::lag()\nx dplyr::mutate()      masks plyr::mutate()\nx dplyr::rename()      masks plyr::rename()\nx MASS::select()       masks dplyr::select()\nx dplyr::summarise()   masks plyr::summarise()\nx dplyr::summarize()   masks plyr::summarize()\n```\n:::\n\n```{.r .cell-code}\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'data.table'\n\nThe following object is masked from 'package:purrr':\n\n    transpose\n\nThe following objects are masked from 'package:reshape2':\n\n    dcast, melt\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n```\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'kableExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n:::\n:::\n\n\n\n\n## Deal with the mapping file for our genomes\n\n### Load mapping file\n\nmapping file = a table that has the metadata for our genomes. \nIn this specific example it lists our 46 DPANN genomes into clusters based on their phylogenetic placement. \n\nWe later want to summarize our data by individual bins and the phylogenetic clusters defined in the mapping file.\n\nNotice: We can also sort our mapping file beforehand and use this order to order our tables, graph, etc...\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in the mapping file\ndesign <- read.table(\"../data/mapping.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\n\n#check the structure of the mapping file\nhead(design)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l}\n\\hline\nBinID & Cluster\\\\\n\\hline\nNIOZ132\\_cc\\_b51\\_2 & Basal\\\\\n\\hline\nNIOZ134\\_mx\\_b281\\_2 & Basal\\\\\n\\hline\nSRR2090153\\_bin1042 & Aquifer\\\\\n\\hline\nSRR2090153\\_bin461 & Aquifer\\\\\n\\hline\nSRR2090159\\_bin1129 & Aquifer\\\\\n\\hline\nSRR2090159\\_bin1288 & Aquifer\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\n## Clean mapping file\n\nHere, we want to add an extra column that summarizes how many genomes are in each phylogenetic cluster.\n\nFirst lets summarize how many bins we have for each cluster:\n\n- ``ddply()`` = summarize our data by counting the number of bins we have in each cluster\n- ``order()`` = next, we order our data based on the clusters with the greater number of bins\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#add a new column that links the BinID and the taxonomic cluster\ndesign$NewName2 <-paste(design$BinID, design$Cluster, sep = \"-\")\nhead(design)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l}\n\\hline\nBinID & Cluster & NewName2\\\\\n\\hline\nNIOZ132\\_cc\\_b51\\_2 & Basal & NIOZ132\\_cc\\_b51\\_2-Basal\\\\\n\\hline\nNIOZ134\\_mx\\_b281\\_2 & Basal & NIOZ134\\_mx\\_b281\\_2-Basal\\\\\n\\hline\nSRR2090153\\_bin1042 & Aquifer & SRR2090153\\_bin1042-Aquifer\\\\\n\\hline\nSRR2090153\\_bin461 & Aquifer & SRR2090153\\_bin461-Aquifer\\\\\n\\hline\nSRR2090159\\_bin1129 & Aquifer & SRR2090159\\_bin1129-Aquifer\\\\\n\\hline\nSRR2090159\\_bin1288 & Aquifer & SRR2090159\\_bin1288-Aquifer\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#transform mapping file and summarize how many genomes we have/cluster\nNumber_of_taxa <- ddply(design, .(Cluster), summarize, NrGenomes = length(Cluster))\n\n#order our data\nNumber_of_taxa <- Number_of_taxa[order(Number_of_taxa$NrGenomes, decreasing = TRUE),] \n\n#view data\nhead(Number_of_taxa)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|r}\n\\hline\n  & Cluster & NrGenomes\\\\\n\\hline\n4 & Clade2 & 23\\\\\n\\hline\n3 & Clade1 & 11\\\\\n\\hline\n5 & Marine & 6\\\\\n\\hline\n1 & Aquifer & 4\\\\\n\\hline\n2 & Basal & 2\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\nNext, add this information into our original mapping file:\n\n- ``paste()`` = paste together different columns. With sep we can control what delimiter we want to use when combining info\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#add a new column with the cluster count info into mapping file (then it can be added as a label into figures)\ndesign_2 <- merge(design, Number_of_taxa, by = \"Cluster\" )\n\n#view wether all went fine\nhead(design_2)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|r}\n\\hline\nCluster & BinID & NewName2 & NrGenomes\\\\\n\\hline\nAquifer & SRR2090153\\_bin1042 & SRR2090153\\_bin1042-Aquifer & 4\\\\\n\\hline\nAquifer & SRR2090153\\_bin461 & SRR2090153\\_bin461-Aquifer & 4\\\\\n\\hline\nAquifer & SRR2090159\\_bin1129 & SRR2090159\\_bin1129-Aquifer & 4\\\\\n\\hline\nAquifer & SRR2090159\\_bin1288 & SRR2090159\\_bin1288-Aquifer & 4\\\\\n\\hline\nBasal & NIOZ132\\_cc\\_b51\\_2 & NIOZ132\\_cc\\_b51\\_2-Basal & 2\\\\\n\\hline\nBasal & NIOZ134\\_mx\\_b281\\_2 & NIOZ134\\_mx\\_b281\\_2-Basal & 2\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\nNext, let's merge all relevant into one column using ``paste()`` again:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#generate a new column into the mapping file that links the cluster name with the number of genomes of clusters in each cluster\ndesign_2$ClusterName <- paste(design_2$Cluster, \" (\", design_2$NrGenomes, \")\", sep = \"\")\n\n#view data\nhead(design_2)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|r|l}\n\\hline\nCluster & BinID & NewName2 & NrGenomes & ClusterName\\\\\n\\hline\nAquifer & SRR2090153\\_bin1042 & SRR2090153\\_bin1042-Aquifer & 4 & Aquifer (4)\\\\\n\\hline\nAquifer & SRR2090153\\_bin461 & SRR2090153\\_bin461-Aquifer & 4 & Aquifer (4)\\\\\n\\hline\nAquifer & SRR2090159\\_bin1129 & SRR2090159\\_bin1129-Aquifer & 4 & Aquifer (4)\\\\\n\\hline\nAquifer & SRR2090159\\_bin1288 & SRR2090159\\_bin1288-Aquifer & 4 & Aquifer (4)\\\\\n\\hline\nBasal & NIOZ132\\_cc\\_b51\\_2 & NIOZ132\\_cc\\_b51\\_2-Basal & 2 & Basal (2)\\\\\n\\hline\nBasal & NIOZ134\\_mx\\_b281\\_2 & NIOZ134\\_mx\\_b281\\_2-Basal & 2 & Basal (2)\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\n\n## Generate lists to order dataframes\n\nThe default behaviour of a lot of R functions is to order data alphabetically but this is not what we might want. \nI.e. we want to order by different columns or simply order by the initial order in our mapping file. \nTo do this it is useful to have vectors that are order our bins, clusters, etc... like we want them.\n\nIn this example the mapping file was ordered like this\n\n- The basal group\n- Groups from an older dataset (marine and aquifer)\n- two black sea clades\n\nLets first check, whether our new mapping file still has that order\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#check the old data\ndesign$Cluster\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Basal\"   \"Basal\"   \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Marine\" \n [8] \"Marine\"  \"Marine\"  \"Marine\"  \"Marine\"  \"Marine\"  \"Clade1\"  \"Clade1\" \n[15] \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\" \n[22] \"Clade1\"  \"Clade1\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[29] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[36] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[43] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n```\n:::\n\n```{.r .cell-code}\n#check the new data\ndesign_2$Cluster\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Basal\"   \"Basal\"   \"Clade1\" \n [8] \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\" \n[15] \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[22] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[29] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[36] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Marine\"  \"Marine\" \n[43] \"Marine\"  \"Marine\"  \"Marine\"  \"Marine\" \n```\n:::\n:::\n\n\n\nIf we check the individual factors, we can see that the new dataframe is order by alphabet. Since this is not what we want, lets correct this\n\n- ``match(design_2$BinID, design$BinID)`` = We check what positions in design_2 match with design. Here, the first argument are the values to be matched and the second are the values to be matched against.\n- ``order()`` = we reorder our dataframe based on the results from ``match()``\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#reorder our old dataframe by the original one\ndesign_2 <- design_2[ order(match(design_2$BinID, design$BinID)), ]\n\n#check, if the basal clade is now in the correct order\ndesign_2$Cluster\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Basal\"   \"Basal\"   \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Aquifer\" \"Marine\" \n [8] \"Marine\"  \"Marine\"  \"Marine\"  \"Marine\"  \"Marine\"  \"Clade1\"  \"Clade1\" \n[15] \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\"  \"Clade1\" \n[22] \"Clade1\"  \"Clade1\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[29] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[36] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n[43] \"Clade2\"  \"Clade2\"  \"Clade2\"  \"Clade2\" \n```\n:::\n:::\n\n\n\nNow, that the basal clade is in the first position, lets make vectors of the bins and clusters in order this we use:\n\n- ``unique()`` = we use unique on all ClusterNames in our mapping file. That way instead of having repeated names, we only have the unique ones\n- ``as.character()`` = we make sure that our R object we generated is a character (so has words).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#make a list to order our bins\nBin_order <- as.character(unique(design_2$BinID))\nBin_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"NIOZ132_cc_b51_2\"   \"NIOZ134_mx_b281_2\"  \"SRR2090153_bin1042\"\n [4] \"SRR2090153_bin461\"  \"SRR2090159_bin1129\" \"SRR2090159_bin1288\"\n [7] \"GCA_002494525\"      \"GCA_002495465\"      \"GCA_002501985\"     \n[10] \"SRR4028224_bin17\"   \"SRR5007147_bin71\"   \"U_76725\"           \n[13] \"NIOZ124_cc_b247_2\"  \"NIOZ125_mb_b254_2\"  \"NIOZ129_mb_b262_2\" \n[16] \"NIOZ126_mb_b401_2\"  \"NIOZ122_mb_b319_2\"  \"NIOZ134_mb_b41_2\"  \n[19] \"NIOZ132_mb_b282_2\"  \"NIOZ127_mb_b161_2\"  \"NIOZ123_bs_b5_2\"   \n[22] \"NIOZ121_cc_b94_2\"   \"NIOZ136_cc_b15_2\"   \"GCA_002502135\"     \n[25] \"NIOZ134_mb_b293_2\"  \"NIOZ132_mb_b260_2\"  \"NIOZ126_mb_b137_2\" \n[28] \"NIOZ129_mb_b254_2\"  \"NIOZ127_mb_b282_2\"  \"NIOZ122_mb_b305_2\" \n[31] \"NIOZ136_mb_b335_2\"  \"NIOZ132_mb_b198_2\"  \"NIOZ136_mb_b104_2\" \n[34] \"NIOZ125_mb_b178_2\"  \"NIOZ121_mb_b48_2\"   \"NIOZ134_cc_b149_2\" \n[37] \"NIOZ134_mb_b361_2\"  \"NIOZ136_mb_b226_2\"  \"NIOZ123_bs_b392_2\" \n[40] \"NIOZ124_mb_b130_2\"  \"NIOZ132_cc_b149_2\"  \"NIOZ125_cc_b75_2\"  \n[43] \"NIOZ132_mx_b314_2\"  \"NIOZ120_mb_b229_2\"  \"NIOZ126_mb_b304_2\" \n[46] \"NIOZ119_mb_b5_2\"   \n```\n:::\n\n```{.r .cell-code}\n#make cluster order\nCluster_order <- as.character(unique(design_2$ClusterName))\nCluster_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Basal (2)\"   \"Aquifer (4)\" \"Marine (6)\"  \"Clade1 (11)\" \"Clade2 (23)\"\n```\n:::\n:::\n\n\n\n\n## Deal with mapping files for the annotations\n\nThe mapping files (Arcog_mapping and Metabolism_file_KEGG) that are provided with this tutorial give extra information and order our KO and arCOG annotations.\nGenes_of_interest is a list of key metabolic genes we want to look at more closely.\n\n\n### Load and view the tables\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#general mapping file for arcog IDs\nArcog_mapping <- read.table(\"../data/ar14_arCOGdef19.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\nhead(Arcog_mapping)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|l|l|l|l|l}\n\\hline\narcog & Pathway & GeneID & Gene & COG & PFAM & CD & TIGR\\\\\n\\hline\narCOG00001 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00002 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & TIGR03433\\\\\n\\hline\narCOG00004 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00005 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00006 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00007 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 &  &  & \\\\\n\\hline\n\\end{tabular}\n:::\n\n```{.r .cell-code}\n#pathway mapping file\nMetabolism_file_KEGG <- read.table(\"../data/Metabolism_Table_KO_Apr2020.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\nhead(Metabolism_file_KEGG)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|l|l|l}\n\\hline\nIDs & KO & pathway\\_A & order & Gene & Comment.Uniprot.comment\\\\\n\\hline\nID1 &  & Nitrogen &  &  & \\\\\n\\hline\nID2 & K02567 & Nitrogen & N1 & napA; periplasmic nitrate reductase NapA [EC:1.7.99.4] & Dissimilatory\\\\\n\\hline\nID3 & TIGR01706 & Nitrogen & N1 & \"napA,  periplasmic nitrate reductase\" & Dissimilatory\\\\\n\\hline\nID4 & K02573 & no\\_pathway &  & napG; ferredoxin-type protein NapG & \\\\\n\\hline\nID5 & K02574 & no\\_pathway &  &  & \\\\\n\\hline\nID6 & K00367 & Nitrogen & N1 & narB; ferredoxin-nitrate reductase [EC:1.7.7.2] & Assimilatory\\\\\n\\hline\n\\end{tabular}\n:::\n\n```{.r .cell-code}\n#load the genes of interest\nGenes_of_interest <- read.table(\"../data/Genes_of_interest.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\nhead(Arcog_mapping)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|l|l|l|l|l}\n\\hline\narcog & Pathway & GeneID & Gene & COG & PFAM & CD & TIGR\\\\\n\\hline\narCOG00001 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00002 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & TIGR03433\\\\\n\\hline\narCOG00004 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00005 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00006 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 & pfam03551 &  & \\\\\n\\hline\narCOG00007 & K & - & \"Transcriptional regulator, PadR family\" & COG01695 &  &  & \\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\n\n### Make a vector to order our genes of interest\n\n- We use ``unique()`` to remove any duplicate gene names\n- ``arrange()`` can be used to order our dataframe by more than one column.\n\nYou notice here that the syntax for ``arrange()`` is a bit unusual and we use the `` %>%`` symbol (a so-called forward pipe operator).\nThis symbol is commonly used in the **dplyr** and **tidyr** packages which are extremely useful to summarize data.\nThis function passes the left hand side of the operator to the first argument of the right hand side of the operator. \nIn the following example, the data frame Genes_of_interest gets passed to ``arrange()``\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#order metabolic genes\nGenes_Metabolism_order_temp <- Genes_of_interest %>% arrange(Order, Order2)\n\n#make a unique vector for our genes of interest\nGenes_Metabolism_order <- as.character(unique(Genes_Metabolism_order_temp$Gene))\nGenes_Metabolism_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] \"HmgB\"                     \"HmgA\"                    \n  [3] \"MvK\"                      \"M3k\"                     \n  [5] \"M3P5K\"                    \"mvaD\"                    \n  [7] \"Ipk\"                      \"GFPS\"                    \n  [9] \"EgsA\"                     \"GGGP_synthase\"           \n [11] \"UbiA\"                     \"GGR\"                     \n [13] \"CarS\"                     \"PgsA\"                    \n [15] \"ASS\"                      \"Asd\"                     \n [17] \"Pol-B1\"                   \"Pol-B2\"                  \n [19] \"Pol-B3\"                   \"PolB-casposon-associated\"\n [21] \"PolD_small\"               \"PolD_large\"              \n [23] \"Pol4\"                     \"PolX\"                    \n [25] \"Orc1\"                     \"SSB/RPA1\"                \n [27] \"RPA2\"                     \"RPA3\"                    \n [29] \"GinS\"                     \"PriS\"                    \n [31] \"PriL\"                     \"DnaG\"                    \n [33] \"Lig \"                     \"LigN\"                    \n [35] \"Pcn1\"                     \"RfcS\"                    \n [37] \"RfcL\"                     \"FEN1\"                    \n [39] \"RnhA\"                     \"RnhB\"                    \n [41] \"MCM2\"                     \"MPH1\"                    \n [43] \"BRR2\"                     \"MUS81\"                   \n [45] \"SrmB\"                     \"Dna2\"                    \n [47] \"TopA\"                     \"GyrA\"                    \n [49] \"GyrB\"                     \"Rgy\"                     \n [51] \"TopB\"                     \"Top6A\"                   \n [53] \"Top6B\"                    \"RecJ/Cdc45\"              \n [55] \"SbcC\"                     \"SbcD\"                    \n [57] \"NurA\"                     \"Nth\"                     \n [59] \"Nfo\"                      \"Nfi\"                     \n [61] \"NucS\"                     \"XthA\"                    \n [63] \"DinG\"                     \"SSO0112\"                 \n [65] \"HerA\"                     \"RadA\"                    \n [67] \"RadB\"                     \"Udg1 \"                   \n [69] \"AlkD\"                     \"Ogt\"                     \n [71] \"Ogg\"                      \"hjc\"                     \n [73] \"UvrA\"                     \"UvrB\"                    \n [75] \"UvrC\"                     \"MthTI\"                   \n [77] \"MthZI\"                    \"MjaII\"                   \n [79] \"MjaIII\"                   \"MjaV\"                    \n [81] \"Dcm\"                      \"DNA_met\"                 \n [83] \"HmfAB\"                    \"HmvA\"                    \n [85] \"ScpA\"                     \"ScpB\"                    \n [87] \"MC1\"                      \"Smc\"                     \n [89] \"Alba1\"                    \"ELP3\"                    \n [91] \"FtsZ\"                     \"MinD\"                    \n [93] \"Cren-1\"                   \"actin_like\"              \n [95] \"Rkd1\"                     \"Rkd2\"                    \n [97] \"CetZ1\"                    \"CdvA\"                    \n [99] \"CdvB\"                     \"Vps4\"                    \n[101] \"RpoC/Rpo3\"                \"RpoC/Rpo11\"              \n[103] \"RpoB/Rpo2\"                \"RpoA/Rpo1\"               \n[105] \"Rpo6/RpoZ\"                \"RPB11\"                   \n[107] \"Rpo4\"                     \"RPB5\"                    \n[109] \"RPB7\"                     \"RPB8\"                    \n[111] \"RPB10\"                    \"RPC12\"                   \n[113] \"Rpo13\"                    \"TBP\"                     \n[115] \"TFB\"                      \"TFE\"                     \n[117] \"TFS\"                      \"LysM\"                    \n[119] \"Spt4\"                     \"NusG\"                    \n[121] \"NusA\"                     \"EGD2\"                    \n[123] \"L1\"                       \"L2\"                      \n[125] \"L3\"                       \"L4\"                      \n[127] \"L5\"                       \"L6P\"                     \n[129] \"L7AE\"                     \"L10\"                     \n[131] \"L10AE/L16\"                \"L11\"                     \n[133] \"L12E/L44/L45/RPP1/RPP2\"   \"L13\"                     \n[135] \"L13E\"                     \"L14\"                     \n[137] \"L14E/L6E/L27E\"            \"L15\"                     \n[139] \"L15E\"                     \"L18\"                     \n[141] \"L18E\"                     \"L19E\"                    \n[143] \"L20A\"                     \"L21E\"                    \n[145] \"L22\"                      \"L23\"                     \n[147] \"L24\"                      \"L24E\"                    \n[149] \"L29\"                      \"L30\"                     \n[151] \"L30E\"                     \"L31E\"                    \n[153] \"L32E\"                     \"L34E\"                    \n[155] \"L35AE/L33A\"               \"L37AE/L43A\"              \n[157] \"L37E\"                     \"L38E\"                    \n[159] \"L39E\"                     \"L40E\"                    \n[161] \"L41E\"                     \"L44E\"                    \n[163] \"S2\"                       \"S3\"                      \n[165] \"S3AE\"                     \"S4\"                      \n[167] \"S4E\"                      \"S5\"                      \n[169] \"S6E/S10\"                  \"S7\"                      \n[171] \"S8\"                       \"S8E\"                     \n[173] \"S9\"                       \"S10\"                     \n[175] \"S11\"                      \"S12\"                     \n[177] \"S13\"                      \"S14\"                     \n[179] \"S15P\"                     \"S17\"                     \n[181] \"S17E\"                     \"S19\"                     \n[183] \"S19E\"                     \"S24E\"                    \n[185] \"S25\"                      \"S26\"                     \n[187] \"S27AE\"                    \"S27E\"                    \n[189] \"S28E/S33\"                 \"S30\"                     \n[191] \"PelA\"                     \"RsgA\"                    \n[193] \"HflX\"                     \"AlaS\"                    \n[195] \"ArgS\"                     \"AsnS\"                    \n[197] \"CysS\"                     \"GlnS\"                    \n[199] \"GRS1\"                     \"HisS\"                    \n[201] \"IleS\"                     \"LeuS\"                    \n[203] \"LysS\"                     \"LysU\"                    \n[205] \"MetG\"                     \"PheS\"                    \n[207] \"SerS\"                     \"ProS\"                    \n[209] \"ThrS\"                     \"TrpS\"                    \n[211] \"TyrS\"                     \"ValS\"                    \n[213] \"EIF1A\"                    \"InfB\"                    \n[215] \"SUI1\"                     \"EIF2A\"                   \n[217] \"EIF2B \"                   \"EIF2B-like\"              \n[219] \"EIF2G\"                    \"EIF4A\"                   \n[221] \"EIF5a\"                    \"EIF6\"                    \n[223] \"Tuf\"                      \"EFB1\"                    \n[225] \"FusA\"                     \"eRF1\"                    \n[227] \"Rli1\"                     \"Csl4\"                    \n[229] \"Rrp4\"                     \"Rrp41\"                   \n[231] \"Rrp42\"                    \"Dph2\"                    \n[233] \"Dph5\"                     \"Dph6\"                    \n[235] \"Trm5\"                     \"TYW1\"                    \n[237] \"TYW2\"                     \"TYW3\"                    \n[239] \"EndA\"                     \"Fau1\"                    \n[241] \"LigT\"                     \"Nob1\"                    \n[243] \"RtcB\"                     \"Archaease\"               \n[245] \"RCL1\"                     \"RnjA\"                    \n[247] \"Rnz\"                      \"Rnp1\"                    \n[249] \"Rnp2\"                     \"Rnp3\"                    \n[251] \"Rnp4\"                     \"TgtA\"                    \n[253] \"DnaJ\"                     \"DnaK\"                    \n[255] \"GrpE\"                     \"GroL\"                    \n[257] \"HtpX\"                     \"Hsp16\"                   \n[259] \"Hsp19\"                    \"PsmA\"                    \n[261] \"PRE1\"                     \"Pan1\"                    \n[263] \"Pcm\"                      \"ThsA\"                    \n```\n:::\n\n```{.r .cell-code}\n#define a order for metabolic pathways\nPathway_order <- as.character(unique(Genes_of_interest$pathway_2))\nPathway_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"DNA_Polymerase\"       \"RFs\"                  \"Helicase\"            \n [4] \"Topoisomerase\"        \"Repair_Recombination\" \"Methylase\"           \n [7] \"Chromatin\"            \"Cell_cycle\"           \"RNA_Polymerase\"      \n[10] \"TFs\"                  \"Transcription\"        \"Ribosome\"            \n[13] \"tRNA_synthetase\"      \"Exosome\"              \"Diphthamide_BS\"      \n[16] \"Wybutosine_BS\"        \"Translation\"          \"Posttranslation\"     \n[19] \"Mevalonate\"           \"Lipids\"              \n```\n:::\n:::\n\n\n\n\n\n## Deal with annotation file\n\n### Read in table \n\nYou already here notice that this takes a bit longer and we just work with 46 bins. \nThis is a good reason to keep python in mind as depending on your computer the more memory heavy operations might get challenging. \nAnother alternative would be to run R on the clusters.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in data and view it\nInput <- read.table(\"../data/UAP2_Annotation_table_u.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\nhead(Input)\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l|l|l|l|l|l|r|r|l|r|r|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l|l}\n\\hline\naccession & BinID & TaxString & NewContigID & OldContigId & ContigIdMerge & ContigNewLength & GC & ProteinID & ProteinGC & ProteinLength & Prokka & arcogs & arcogs\\_geneID & arcogs\\_Description & Pathway & arcogs\\_evalue & KO\\_hmm & e\\_value & bit\\_score & bit\\_score\\_cutoff & Definition & confidence & PFAM\\_hmm & PFAM\\_description & Pfam\\_Evalue & TIRGR & TIGR\\_description & EC & TIGR\\_Evalue & CAZy & CAZy\\_evalue & Description & TDBD\\_ID & TPDB\\_evalue & HydDB & Description.1 & HydDB\\_evalue & PFAM & PFAMdescription & IPR & IPRdescription & TopHit & E\\_value & PecID & TaxID & TaxString.1\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00010 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_1 & NIOZ119\\_sc1610046\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_1 & 2539 & 0.432 & PJFDGLDN\\_00010 & 0.094 & 350 & Digeranylgeranylglycerophospholipid reductase & arCOG00570 & - & \"Geranylgeranyl\\_reductase,\\_flavoprotein\" & I & 2.80E-75 & K17830 & 2.10E-69 & 243.3 & 246.87 & digeranylgeranylglycerophospholipid\\_reductase\\_[EC:1.3.1.101\\_1.3.7.11] & - & PF01494 & FAD\\_binding\\_domain & 5.90E-09 & TIGR02032 & geranylgeranyl\\_reductase\\_family & 1.3.1.- & 1.40E-49 & - & - & - & - & - & - & - & - & IPR036188;\\_IPR002938 & FAD/NAD(P)-binding\\_domain\\_superfamily;\\_FAD-binding\\_domain & PF01494 & FAD\\_binding\\_domain & KYK22416.1\\_hypothetical\\_protein\\_AYK24\\_02275\\_[Thermoplasmatales\\_archaeon\\_SG8-52-4] & 2.80E-58 & 36.5 & 1803819 & \"Archaea,Euryarchaeota,Thermoplasmata,Thermoplasmatales,none,none,Thermoplasmatales\\_archaeon\\_SG8-52-4\"\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00020 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_1 & NIOZ119\\_sc1610046\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_1 & 2539 & 0.432 & PJFDGLDN\\_00020 & 0.057 & 105 & hypothetical protein & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & - & -\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00030 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_1 & NIOZ119\\_sc1610046\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_1 & 2539 & 0.432 & PJFDGLDN\\_00030 & 0.092 & 304 & tRNA-2-methylthio-N(6)-dimethylallyladenosine synthase & arCOG01358 & MiaB & 2-methylthioadenine\\_synthetase & J & 5.80E-90 & K15865 & 1.20E-109 & 375.8 & 343.7 & threonylcarbamoyladenosine\\_tRNA\\_methylthiotransferase\\_CDKAL1\\_[EC:2.8.4.5] & high\\_score & PF04055 & Radical\\_SAM\\_superfamily & 2.60E-21 & TIGR01578 & \"MiaB-like\\_tRNA\\_modifying\\_enzyme,\\_archaeal-type\" & - & 1.70E-104 & - & - & - & - & - & - & - & - & IPR005839;\\_IPR002792;\\_IPR006466;\\_IPR006638;\\_IPR007197;\\_IPR020612;\\_IPR023404 & \"Methylthiotransferase;\\_TRAM\\_domain;\\_MiaB-like\\_tRNA\\_modifying\\_enzyme,\\_archaeal-type;\\_Elp3/MiaB/NifB;\\_Radical\\_SAM;\\_Methylthiotransferase,\\_conserved\\_site;\\_Radical\\_SAM,\\_alpha/beta\\_horseshoe\" & PF01938;\\_PF04055 & TRAM\\_domain;\\_Radical\\_SAM\\_superfamily & OIO63284.1\\_hypothetical\\_protein\\_AUJ83\\_01460\\_[Candidatus\\_Woesearchaeota\\_archaeon\\_CG1\\_02\\_33\\_12] & 8.20E-91 & 55.6 & 1805422 & \"Archaea,Candidatus\\_Woesearchaeota,none,none,none,none,Candidatus\\_Woesearchaeota\\_archaeon\\_CG1\\_02\\_33\\_12\"\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00040 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_2 & NIOZ119\\_sc560284\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_2 & 4191 & 0.456 & PJFDGLDN\\_00040 & 0.065 & 92 & Enolase & arCOG01169 & Eno & Enolase & G & 4.00E-26 & K01689 & 5.10E-20 & 81 & 48.73 & enolase\\_[EC:4.2.1.11] & high\\_score & PF00113 & \"Enolase,\\_C-terminal\\_TIM\\_barrel\\_domain\" & 1.20E-20 & TIGR01060 & phosphopyruvate\\_hydratase & 4.2.1.11 & 1.10E-25 & - & - & - & - & - & - & - & - & IPR020810;\\_IPR036849;\\_IPR000941;\\_IPR020809 & \"Enolase,\\_C-terminal\\_TIM\\_barrel\\_domain;\\_Enolase-like,\\_C-terminal\\_domain\\_superfamily;\\_Enolase;\\_Enolase,\\_conserved\\_site\" & PF00113 & \"Enolase,\\_C-terminal\\_TIM\\_barrel\\_domain\" & BAW30993.1\\_2-phosphoglycerate\\_dehydratase\\_[Methanothermobacter\\_sp.\\_MT-2] & 3.80E-23 & 70.7 & 1898379 & \"Archaea,Euryarchaeota,Methanobacteria,Methanobacteriales,Methanobacteriaceae,Methanothermobacter,Methanothermobacter\\_sp.\\_MT-2\"\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00050 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_2 & NIOZ119\\_sc560284\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_2 & 4191 & 0.456 & PJFDGLDN\\_00050 & 0.059 & 218 & 30S ribosomal protein S2 & arCOG04245 & RpsB & Ribosomal\\_protein\\_S2 & J & 8.90E-64 & K02998 & 1.60E-46 & 167.8 & 210.97 & small\\_subunit\\_ribosomal\\_protein\\_SAe & - & PF00318 & Ribosomal\\_protein\\_S2 & 7.00E-24 & TIGR01012 & ribosomal\\_protein\\_uS2 & - & 1.00E-72 & - & - & - & - & - & - & - & - & IPR005707;\\_IPR023454;\\_IPR023591;\\_IPR018130;\\_IPR001865 & \"Ribosomal\\_protein\\_S2,\\_eukaryotic/archaeal;\\_Ribosomal\\_protein\\_S2,\\_archaeal;\\_Ribosomal\\_protein\\_S2,\\_flavodoxin-like\\_domain\\_superfamily;\\_Ribosomal\\_protein\\_S2,\\_conserved\\_site;\\_Ribosomal\\_protein\\_S2\" & PF00318 & Ribosomal\\_protein\\_S2 & A0B6E5.1\\_RecName:\\_Full=30S\\_ribosomal\\_protein\\_S2 & 1.20E-56 & 52.8 & 349307 & \"Archaea,Euryarchaeota,Methanomicrobia,Methanosarcinales,Methanotrichaceae,Methanothrix,Methanothrix\\_thermoacetophila\"\\\\\n\\hline\nNIOZ119\\_mb\\_b5\\_2-PJFDGLDN\\_00060 & NIOZ119\\_mb\\_b5\\_2 & UAP2 & PJFDGLDN\\_2 & NIOZ119\\_sc560284\\_1 & NIOZ119\\_mb\\_b5\\_2\\_contig\\_2 & 4191 & 0.456 & PJFDGLDN\\_00060 & 0.100 & 280 & hypothetical protein & arCOG01728 & Mho1 & \"Predicted\\_class\\_III\\_extradiol\\_dioxygenase,\\_MEMO1\\_family\" & R & 8.80E-74 & K06990 & 1.40E-72 & 253.3 & 47 & MEMO1\\_family\\_protein & high\\_score & PF01875 & Memo-like\\_protein & 4.50E-77 & TIGR04336 & AmmeMemoRadiSam\\_system\\_protein\\_B & - & 5.30E-91 & - & - & - & - & - & - & - & - & IPR002737 & MEMO1\\_family & PF01875 & Memo-like\\_protein & OYT50994.1\\_AmmeMemoRadiSam\\_system\\_protein\\_B\\_[Candidatus\\_Bathyarchaeota\\_archaeon\\_ex4484\\_135] & 1.30E-66 & 47 & 2012509 & \"Archaea,Candidatus\\_Bathyarchaeota,none,none,none,none,Candidatus\\_Bathyarchaeota\\_archaeon\\_ex4484\\_135\"\\\\\n\\hline\n\\end{tabular}\n:::\n:::\n\n\n\n### Make a mapping file that links all annotation IDs to their descriptions \n\nWhat we do:\n\n- separate columns we are interested in for each Database of interest, i.e. arCOGs, and remove duplicate rows by using ``unique()``\n- change the column names using ``colnames()``. Here, we want to make sure that all the 6 new objects we generate have the same columns\n- combine our 6 dataframes using ``rbind()``. For this to work we need the same number of columns.\n\nIn theory that would be a nice example for a loop as well, since we do exactly the same thing for 6x.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#generate Description table for all DBs of interest\nArcogs_Description <- unique(Input[,c(\"arcogs\",\"arcogs_Description\" )])\ncolnames(Arcogs_Description) <- c(\"Gene\", \"Description\")\nkable((head(Arcogs_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|Gene       |Description                                               |\n|:----------|:---------------------------------------------------------|\n|arCOG00570 |\"Geranylgeranyl_reductase,_flavoprotein\"                  |\n|-          |-                                                         |\n|arCOG01358 |2-methylthioadenine_synthetase                            |\n|arCOG01169 |Enolase                                                   |\n|arCOG04245 |Ribosomal_protein_S2                                      |\n|arCOG01728 |\"Predicted_class_III_extradiol_dioxygenase,_MEMO1_family\" |\n:::\n\n```{.r .cell-code}\nKOs_Description <- Input[,c(\"KO_hmm\",\"Definition\" )]\ncolnames(KOs_Description) <- c(\"Gene\", \"Description\")\nkable((head(KOs_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|Gene   |Description                                                               |\n|:------|:-------------------------------------------------------------------------|\n|K17830 |digeranylgeranylglycerophospholipid_reductase_[EC:1.3.1.101_1.3.7.11]     |\n|-      |-                                                                         |\n|K15865 |threonylcarbamoyladenosine_tRNA_methylthiotransferase_CDKAL1_[EC:2.8.4.5] |\n|K01689 |enolase_[EC:4.2.1.11]                                                     |\n|K02998 |small_subunit_ribosomal_protein_SAe                                       |\n|K06990 |MEMO1_family_protein                                                      |\n:::\n\n```{.r .cell-code}\nPfam_Description <- unique(Input[,c(\"PFAM_hmm\",\"PFAM_description\" )])\ncolnames(Pfam_Description) <- c(\"Gene\", \"Description\")\nkable((head(Pfam_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|Gene    |Description                             |\n|:-------|:---------------------------------------|\n|PF01494 |FAD_binding_domain                      |\n|-       |-                                       |\n|PF04055 |Radical_SAM_superfamily                 |\n|PF00113 |\"Enolase,_C-terminal_TIM_barrel_domain\" |\n|PF00318 |Ribosomal_protein_S2                    |\n|PF01875 |Memo-like_protein                       |\n:::\n\n```{.r .cell-code}\nTIRGR_Description <- unique(Input[,c(\"TIRGR\",\"TIGR_description\" )])\ncolnames(TIRGR_Description) <- c(\"Gene\", \"Description\")\nkable((head(TIRGR_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|Gene      |Description                                      |\n|:---------|:------------------------------------------------|\n|TIGR02032 |geranylgeranyl_reductase_family                  |\n|-         |-                                                |\n|TIGR01578 |\"MiaB-like_tRNA_modifying_enzyme,_archaeal-type\" |\n|TIGR01060 |phosphopyruvate_hydratase                        |\n|TIGR01012 |ribosomal_protein_uS2                            |\n|TIGR04336 |AmmeMemoRadiSam_system_protein_B                 |\n:::\n\n```{.r .cell-code}\nCazy_Description <- unique(Input[,c(\"CAZy\",\"Description\" )])\ncolnames(Cazy_Description) <- c(\"Gene\", \"Description\")\nkable((head(Cazy_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|     |Gene                |Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|:----|:-------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|1    |-                   |-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|81   |GH119               |__alpha-amylase_(EC_3.2.1.1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|245  |GT4                 |\"__sucrose_synthase_(EC_2.4.1.13);_sucrose-phosphate_synthase_(EC_2.4.1.14);_alpha-glucosyltransferase_(EC_2.4.1.52);_lipopolysaccharide_N-acetylglucosaminyltransferase_(EC_2.4.1.56);_phosphatidylinositol_alpha-mannosyltransferase_(EC_2.4.1.57);_GDP-Man:_Man1GlcNAc2-PP-dolichol_alpha-1,3-mannosyltransferase_(EC_2.4.1.132);_GDP-Man:_Man3GlcNAc2-PP-dolichol/Man4GlcNAc2-PP-dolichol_alpha-1,2-mannosyltransferase_(EC_2.4.1.131);_digalactosyldiacylglycerol_synthase_(EC_2.4.1.141);_1,2-diacylglycerol_3-glucosyltransferase_(EC_2.4.1.157);__diglucosyl_diacylglycerol_synthase_(EC_2.4.1.208);_trehalose_phosphorylase_(EC_2.4.1.231);_NDP-Glc:_alpha-glucose_alpha-glucosyltransferase_/_alpha,alpha-trehalose_synthase_(EC_2.4.1.245);_GDP-Man:_Man2GlcNAc2-PP-dolichol_alpha-1,6-mannosyltransferase_(EC_2.4.1.257);_UDP-GlcNAc:_2-deoxystreptamine_alpha-N-acetylglucosaminyltransferase_(EC_2.4.1.283);_UDP-GlcNAc:_ribostamycin_alpha-N-acetylglucosaminyltransferase_(EC_2.4.1.285);_UDP-Gal_alpha-galactosyltransferase_(EC_2.4.1.-);_UDP-Xyl_alpha-xylosyltransferase_(EC_2.4.2.-);_UDP-GlcA_alpha-glucuronyltransferase_(EC_2.4.1.-);_UDP-Glc_alpha-glucosyltransferase_(EC_2.4.1.-);_UDP-GalNAc:_GalNAc-PP-Und_alpha-1,3-N-acetylgalactosaminyltransferase_(EC_2.4.1.306);_UDP-GalNAc:_N,N'-diacetylbacillosaminyl-PP-Und_alpha-1,3-N-acetylgalactosaminyltransferase_(EC_2.4.1.290);_ADP-dependent_alpha-maltose-1-phosphate_synthase_(2.4.1.342)\" |\n|291  |GT2_Glycos_transf_2 |-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|613  |GT83                |__undecaprenyl_phosphate-alpha-L-Ara4N:_4-amino-4-deoxy-beta-L-arabinosyltransferase_(EC_2.4.2.43);_dodecaprenyl_phosphate-beta-galacturonic_acid:_lipopolysaccharide_core_alpha-galacturonosyl_transferase_(EC_2.4.1.-)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|1357 |GT66                |__dolichyl-diphosphooligosaccharide<c3><83><c2><a2><c3><a2><e2><80><9a><c2><ac><c3><a2><e2><82><ac><c2><9d>protein_glycotransferase_(EC_2.4.99.18);_undecaprenyl-diphosphooligosaccharide<c3><83><c2><a2><c3><a2><e2><80><9a><c2><ac><c3><a2><e2><82><ac><c2><9d>protein_glycotransferase_(EC_2.4.99.19)_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n:::\n\n```{.r .cell-code}\nHydDB_Description <- unique(Input[,c(\"Description.1\",\"Description.1\" )])\ncolnames(HydDB_Description) <- c(\"Gene\", \"Description\")\nkable((head(HydDB_Description)), format='markdown')\n```\n\n::: {.cell-output-display}\n|      |Gene            |Description     |\n|:-----|:---------------|:---------------|\n|1     |-               |-               |\n|4787  |[FeFe]_Group_A1 |[FeFe]_Group_A1 |\n|18935 |[NiFe]_Group_4g |[NiFe]_Group_4g |\n|19355 |[NiFe]_Group_3b |[NiFe]_Group_3b |\n|37081 |[FeFe]_Group_C3 |[FeFe]_Group_C3 |\n:::\n\n```{.r .cell-code}\n#make a file with a description of all the ids for each search\nAll_Genes_Description <- rbind(Arcogs_Description,KOs_Description,Pfam_Description,TIRGR_Description, Cazy_Description, HydDB_Description)\n```\n:::\n\n\n\n\n### Parse table to make it easier to work with it\n\nHere we:\n\n- Subset the data for the columns we are interested in. Esp. for larger dataframes this will make the operations a bit quicker. For very large dataframes, i.e. 5000 genomes, it might be better to switch to python\n- Convert data from wide to long format\n- Clean factors. After subsetting often factors are not removed, we clean them up in that step\n\nInfo:\n\n**Converting a wide to a long dataframe**\n\n- Wide dataframe: The Input data in this example is considered as a wide dataframe. I.e. all the gene IDs we are interested in are spread out into different columns\n- Long dataframe: The gene IDs we are interested in are found all in the same column. Important, most R functions work with long dataframes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#print the column names to subset our datatable\ncolnames(Input)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"accession\"          \"BinID\"              \"TaxString\"         \n [4] \"NewContigID\"        \"OldContigId\"        \"ContigIdMerge\"     \n [7] \"ContigNewLength\"    \"GC\"                 \"ProteinID\"         \n[10] \"ProteinGC\"          \"ProteinLength\"      \"Prokka\"            \n[13] \"arcogs\"             \"arcogs_geneID\"      \"arcogs_Description\"\n[16] \"Pathway\"            \"arcogs_evalue\"      \"KO_hmm\"            \n[19] \"e_value\"            \"bit_score\"          \"bit_score_cutoff\"  \n[22] \"Definition\"         \"confidence\"         \"PFAM_hmm\"          \n[25] \"PFAM_description\"   \"Pfam_Evalue\"        \"TIRGR\"             \n[28] \"TIGR_description\"   \"EC\"                 \"TIGR_Evalue\"       \n[31] \"CAZy\"               \"CAZy_evalue\"        \"Description\"       \n[34] \"TDBD_ID\"            \"TPDB_evalue\"        \"HydDB\"             \n[37] \"Description.1\"      \"HydDB_evalue\"       \"PFAM\"              \n[40] \"PFAMdescription\"    \"IPR\"                \"IPRdescription\"    \n[43] \"TopHit\"             \"E_value\"            \"PecID\"             \n[46] \"TaxID\"              \"TaxString.1\"       \n```\n:::\n\n```{.r .cell-code}\n#only keep the columns we actually want to work with\nInput_subset = Input[,c('BinID','accession','arcogs','KO_hmm','PFAM_hmm','TIRGR','CAZy','Description.1' )]\nkable((head(Input_subset)), format='markdown')\n```\n\n::: {.cell-output-display}\n|BinID           |accession                      |arcogs     |KO_hmm |PFAM_hmm |TIRGR     |CAZy |Description.1 |\n|:---------------|:------------------------------|:----------|:------|:--------|:---------|:----|:-------------|\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00010 |arCOG00570 |K17830 |PF01494  |TIGR02032 |-    |-             |\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00020 |-          |-      |-        |-         |-    |-             |\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00030 |arCOG01358 |K15865 |PF04055  |TIGR01578 |-    |-             |\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00040 |arCOG01169 |K01689 |PF00113  |TIGR01060 |-    |-             |\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00050 |arCOG04245 |K02998 |PF00318  |TIGR01012 |-    |-             |\n|NIOZ119_mb_b5_2 |NIOZ119_mb_b5_2-PJFDGLDN_00060 |arCOG01728 |K06990 |PF01875  |TIGR04336 |-    |-             |\n:::\n\n```{.r .cell-code}\n#convert dataframe from wide to long\nInput_long <- reshape2::melt(Input_subset,  id=c(\"accession\",\"BinID\"))\n\n#give informative headers\ncolnames(Input_long) <- c(\"accession\", \"BinID\", \"DB\", \"gene\")\n\n#clean factors, to remove issues when counting\nInput_long$gene <- as.factor(Input_long$gene)\nkable((head(Input_long)), format='markdown')\n```\n\n::: {.cell-output-display}\n|accession                      |BinID           |DB     |gene       |\n|:------------------------------|:---------------|:------|:----------|\n|NIOZ119_mb_b5_2-PJFDGLDN_00010 |NIOZ119_mb_b5_2 |arcogs |arCOG00570 |\n|NIOZ119_mb_b5_2-PJFDGLDN_00020 |NIOZ119_mb_b5_2 |arcogs |-          |\n|NIOZ119_mb_b5_2-PJFDGLDN_00030 |NIOZ119_mb_b5_2 |arcogs |arCOG01358 |\n|NIOZ119_mb_b5_2-PJFDGLDN_00040 |NIOZ119_mb_b5_2 |arcogs |arCOG01169 |\n|NIOZ119_mb_b5_2-PJFDGLDN_00050 |NIOZ119_mb_b5_2 |arcogs |arCOG04245 |\n|NIOZ119_mb_b5_2-PJFDGLDN_00060 |NIOZ119_mb_b5_2 |arcogs |arCOG01728 |\n:::\n:::\n\n\n\n## Make count tables\n\n### Generate a count table for our genomes of interest\n\nNow we want to count, how often does a genome (i.e. NIOZ134_mb_b41_2) have a gene. I.e. how often do we want arCOG00570, arCOG01358, ...\n\n##### Do this via  a loop (not executed, just an example)\n\nNotice: \n\nSince we run this chunk with ``, eval = FALSE`` we can still see the code but it is not executed.\nThis is done because some computations take some time, which we do not want to spend, but I still want to show the code to give some alternative examples.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#count the number of proteins for each genome of interest\ny <- c()\nfor (i in Bin_order) {\n  x <-  table(subset(Input_long, BinID %in% paste(i))$gene)\n  y <- cbind (y,x)\n}\n\n#clean-up the table\nCounts_Table_loop <- y\ncolnames(Counts_Table_loop) <- Bin_order\nCounts_Table_loop <- as.data.frame(Counts_Table_loop)\nkable((head(Counts_Table_loop)), format='markdown')\n\n#the '-' (=not identified genes) is also counted and listed in the first column and removed at this step\nCounts_Table_loop <- Counts_Table_loop[-1,]\nkable((head(Counts_Table_loop)), format='markdown')\n```\n:::\n\n\n\n##### Do this via ddply ((not executed, just an example))\n\nNew functions:\n\n- ``spread()`` = converts our long to a wide dataframe by using the BinIDs as new column names, the count table as values to populate our dataframe and with missing values we print a 0.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#count data and clean header\nCounts_Table_long <- ddply(Input_long, .(BinID, gene), summarize, GeneCount = length(gene))\ncolnames(Counts_Table_long) <- c(\"BinID\", \"geneID\", \"count\")\nkable((head(Counts_Table_long)), format='markdown')\n\n#transform to wide format, with fill = 0 instead of a NA we add a 0\nCounts_Table_wide <- spread(Counts_Table_long, BinID, count, fill = 0 )\n\n#view data\nkable((head(Counts_Table_wide)), format='markdown')\n```\n:::\n\n\n\n\n##### Do this via tidyr (usually a bit faster than ddplyr, which is why we use this way)\n\nHere, we use the `` %>%`` symbol again:\nIn the following example, the a subset of the Input_long data (only 3 columns, not the whole dataframe) gets passed to ``count()``\n\nNew functions:\n\n- ``count()`` = A function of the dplyr package. Here, we count the unique protein IDs grouped by BinID and gene (i.e. roughly equivalent to the columns we want to keep)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#count data and clean header\nCounts_Table_long <- Input_long[,c('accession', 'BinID','gene')] %>% count(BinID, gene, sort = FALSE)\ncolnames(Counts_Table_long) <- c(\"BinID\", \"geneID\", \"count\")\nkable((head(Counts_Table_long)), format='markdown')\n```\n\n::: {.cell-output-display}\n|BinID         |geneID              | count|\n|:-------------|:-------------------|-----:|\n|GCA_002494525 |-                   |  2350|\n|GCA_002494525 |GT2_Glyco_tranf_2_3 |     1|\n|GCA_002494525 |GT2_Glycos_transf_2 |     2|\n|GCA_002494525 |GT4                 |     2|\n|GCA_002494525 |GT66                |     1|\n|GCA_002494525 |GT83                |     1|\n:::\n:::\n\n\n\n\nWhen viewing the data we also see that proteins with no annotations are counted (the minus symbol), since we do not care about this at this stage, lets remove everything with a minus symbol\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#delete rows with a minus symbol\nCounts_Table_long <- Counts_Table_long[Counts_Table_long$geneID!= \"-\", ]\n\n#clean factors\nCounts_Table_long$geneID <- factor(Counts_Table_long$geneID)\n\n#view data\nkable((head(Counts_Table_long)), format='markdown')\n```\n\n::: {.cell-output-display}\n|   |BinID         |geneID              | count|\n|:--|:-------------|:-------------------|-----:|\n|2  |GCA_002494525 |GT2_Glyco_tranf_2_3 |     1|\n|3  |GCA_002494525 |GT2_Glycos_transf_2 |     2|\n|4  |GCA_002494525 |GT4                 |     2|\n|5  |GCA_002494525 |GT66                |     1|\n|6  |GCA_002494525 |GT83                |     1|\n|7  |GCA_002494525 |K00012              |     1|\n:::\n:::\n\n\n\nNow, we can convert the long to a wide table, since this format is a bit easier to read in excel later.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#transform to wide format, with fill = 0 instead of a NA we add a 0\nCounts_Table_wide <- spread(Counts_Table_long, BinID, count, fill = 0 )\nkable((head(Counts_Table_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|geneID              | GCA_002494525| GCA_002495465| GCA_002501985| GCA_002502135| NIOZ119_mb_b5_2| NIOZ120_mb_b229_2| NIOZ121_cc_b94_2| NIOZ121_mb_b48_2| NIOZ122_mb_b305_2| NIOZ122_mb_b319_2| NIOZ123_bs_b392_2| NIOZ123_bs_b5_2| NIOZ124_cc_b247_2| NIOZ124_mb_b130_2| NIOZ125_cc_b75_2| NIOZ125_mb_b178_2| NIOZ125_mb_b254_2| NIOZ126_mb_b137_2| NIOZ126_mb_b304_2| NIOZ126_mb_b401_2| NIOZ127_mb_b161_2| NIOZ127_mb_b282_2| NIOZ129_mb_b254_2| NIOZ129_mb_b262_2| NIOZ132_cc_b149_2| NIOZ132_cc_b51_2| NIOZ132_mb_b198_2| NIOZ132_mb_b260_2| NIOZ132_mb_b282_2| NIOZ132_mx_b314_2| NIOZ134_cc_b149_2| NIOZ134_mb_b293_2| NIOZ134_mb_b361_2| NIOZ134_mb_b41_2| NIOZ134_mx_b281_2| NIOZ136_cc_b15_2| NIOZ136_mb_b104_2| NIOZ136_mb_b226_2| NIOZ136_mb_b335_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| SRR4028224_bin17| SRR5007147_bin71| U_76725|\n|:-------------------|-------------:|-------------:|-------------:|-------------:|---------------:|-----------------:|----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|----------------:|----------------:|-------:|\n|CBM44               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 1|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 1|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|CE4                 |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 2|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH119               |             0|             0|             0|             1|               1|                 1|                0|                1|                 0|                 0|                 1|               0|                 0|                 0|                1|                 1|                 0|                 0|                 0|                 0|                 0|                 1|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 1|                 0|                 1|                 0|                0|                 0|                0|                 0|                 1|                 1|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH130               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH95                |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GT2_Glyco_tranf_2_3 |             1|             1|             1|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                1|                0|       1|\n:::\n:::\n\n\n\nAlso, we want our geneIDs to be the new rownames and we do this by using the ``rownames()`` functions.\nWe do this since some functions do not like to have characters in their dataframe.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#change the rownames\nrownames(Counts_Table_wide) <- Counts_Table_wide$geneID\n\n#view data\nkable((head(Counts_Table_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    |geneID              | GCA_002494525| GCA_002495465| GCA_002501985| GCA_002502135| NIOZ119_mb_b5_2| NIOZ120_mb_b229_2| NIOZ121_cc_b94_2| NIOZ121_mb_b48_2| NIOZ122_mb_b305_2| NIOZ122_mb_b319_2| NIOZ123_bs_b392_2| NIOZ123_bs_b5_2| NIOZ124_cc_b247_2| NIOZ124_mb_b130_2| NIOZ125_cc_b75_2| NIOZ125_mb_b178_2| NIOZ125_mb_b254_2| NIOZ126_mb_b137_2| NIOZ126_mb_b304_2| NIOZ126_mb_b401_2| NIOZ127_mb_b161_2| NIOZ127_mb_b282_2| NIOZ129_mb_b254_2| NIOZ129_mb_b262_2| NIOZ132_cc_b149_2| NIOZ132_cc_b51_2| NIOZ132_mb_b198_2| NIOZ132_mb_b260_2| NIOZ132_mb_b282_2| NIOZ132_mx_b314_2| NIOZ134_cc_b149_2| NIOZ134_mb_b293_2| NIOZ134_mb_b361_2| NIOZ134_mb_b41_2| NIOZ134_mx_b281_2| NIOZ136_cc_b15_2| NIOZ136_mb_b104_2| NIOZ136_mb_b226_2| NIOZ136_mb_b335_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| SRR4028224_bin17| SRR5007147_bin71| U_76725|\n|:-------------------|:-------------------|-------------:|-------------:|-------------:|-------------:|---------------:|-----------------:|----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|----------------:|----------------:|-------:|\n|CBM44               |CBM44               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 1|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 1|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|CE4                 |CE4                 |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 2|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH119               |GH119               |             0|             0|             0|             1|               1|                 1|                0|                1|                 0|                 0|                 1|               0|                 0|                 0|                1|                 1|                 0|                 0|                 0|                 0|                 0|                 1|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 1|                 0|                 1|                 0|                0|                 0|                0|                 0|                 1|                 1|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH130               |GH130               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH95                |GH95                |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GT2_Glyco_tranf_2_3 |GT2_Glyco_tranf_2_3 |             1|             1|             1|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                1|                0|       1|\n:::\n:::\n\n\n\n\nWhen we change the rownames and view the data, we see that the geneID is now both in the rownames as well as the first column. \nSince that is a bit messy, we next remove the first column.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#delete the first column\nCounts_Table_wide <- Counts_Table_wide[,-1]\nkable((head(Counts_Table_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    | GCA_002494525| GCA_002495465| GCA_002501985| GCA_002502135| NIOZ119_mb_b5_2| NIOZ120_mb_b229_2| NIOZ121_cc_b94_2| NIOZ121_mb_b48_2| NIOZ122_mb_b305_2| NIOZ122_mb_b319_2| NIOZ123_bs_b392_2| NIOZ123_bs_b5_2| NIOZ124_cc_b247_2| NIOZ124_mb_b130_2| NIOZ125_cc_b75_2| NIOZ125_mb_b178_2| NIOZ125_mb_b254_2| NIOZ126_mb_b137_2| NIOZ126_mb_b304_2| NIOZ126_mb_b401_2| NIOZ127_mb_b161_2| NIOZ127_mb_b282_2| NIOZ129_mb_b254_2| NIOZ129_mb_b262_2| NIOZ132_cc_b149_2| NIOZ132_cc_b51_2| NIOZ132_mb_b198_2| NIOZ132_mb_b260_2| NIOZ132_mb_b282_2| NIOZ132_mx_b314_2| NIOZ134_cc_b149_2| NIOZ134_mb_b293_2| NIOZ134_mb_b361_2| NIOZ134_mb_b41_2| NIOZ134_mx_b281_2| NIOZ136_cc_b15_2| NIOZ136_mb_b104_2| NIOZ136_mb_b226_2| NIOZ136_mb_b335_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| SRR4028224_bin17| SRR5007147_bin71| U_76725|\n|:-------------------|-------------:|-------------:|-------------:|-------------:|---------------:|-----------------:|----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|----------------:|----------------:|-------:|\n|CBM44               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 1|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 1|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|CE4                 |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 2|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH119               |             0|             0|             0|             1|               1|                 1|                0|                1|                 0|                 0|                 1|               0|                 0|                 0|                1|                 1|                 0|                 0|                 0|                 0|                 0|                 1|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 1|                 0|                 1|                 0|                0|                 0|                0|                 0|                 1|                 1|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH130               |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GH95                |             0|             0|             0|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                0|                0|       0|\n|GT2_Glyco_tranf_2_3 |             1|             1|             1|             0|               0|                 0|                0|                0|                 0|                 0|                 0|               0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                0|                 0|                 0|                 0|                  0|                 0|                  0|                  0|                1|                0|       1|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#order our data so that the bins start first with the bins from the basal group\nCounts_Table_wide <- Counts_Table_wide[,Bin_order]\n\n#view data\nkable((head(Counts_Table_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    | NIOZ132_cc_b51_2| NIOZ134_mx_b281_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| GCA_002494525| GCA_002495465| GCA_002501985| SRR4028224_bin17| SRR5007147_bin71| U_76725| NIOZ124_cc_b247_2| NIOZ125_mb_b254_2| NIOZ129_mb_b262_2| NIOZ126_mb_b401_2| NIOZ122_mb_b319_2| NIOZ134_mb_b41_2| NIOZ132_mb_b282_2| NIOZ127_mb_b161_2| NIOZ123_bs_b5_2| NIOZ121_cc_b94_2| NIOZ136_cc_b15_2| GCA_002502135| NIOZ134_mb_b293_2| NIOZ132_mb_b260_2| NIOZ126_mb_b137_2| NIOZ129_mb_b254_2| NIOZ127_mb_b282_2| NIOZ122_mb_b305_2| NIOZ136_mb_b335_2| NIOZ132_mb_b198_2| NIOZ136_mb_b104_2| NIOZ125_mb_b178_2| NIOZ121_mb_b48_2| NIOZ134_cc_b149_2| NIOZ134_mb_b361_2| NIOZ136_mb_b226_2| NIOZ123_bs_b392_2| NIOZ124_mb_b130_2| NIOZ132_cc_b149_2| NIOZ125_cc_b75_2| NIOZ132_mx_b314_2| NIOZ120_mb_b229_2| NIOZ126_mb_b304_2| NIOZ119_mb_b5_2|\n|:-------------------|----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|-------------:|-------------:|-------------:|----------------:|----------------:|-------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|---------------:|----------------:|----------------:|-------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|\n|CBM44               |                0|                 0|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 1|                0|                 1|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|CE4                 |                0|                 2|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|GH119               |                0|                 0|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             1|                 1|                 0|                 0|                 0|                 1|                 0|                 1|                 0|                 0|                 1|                1|                 0|                 0|                 1|                 1|                 0|                 0|                1|                 1|                 1|                 0|               1|\n|GH130               |                0|                 1|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|GH95                |                0|                 1|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|GT2_Glyco_tranf_2_3 |                0|                 0|                  0|                 0|                  0|                  0|             1|             1|             1|                1|                0|       1|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n:::\n:::\n\n\n\nIf you run these three examples yourself, take not how different the speed is.\n\n\n### Generate a count table for our clusters of interest\n\nSame as above, but now we want to know for our 4 aquifer genomes, how many have Gene Xx and show this as percent. I.e. if 1/4 genomes have a gene, then 25% have it.\n\nFirst, lets merge in our taxa info into our count table, we need this to summarize our data by clusters.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merge the count table with mapping file to add in the taxa info (might take a while depending on size)\nCounts_Table_long_Tax <- merge(Counts_Table_long, design_2[,c(\"BinID\", \"ClusterName\", \"NrGenomes\")], by = \"BinID\")\nkable((head(Counts_Table_long_Tax)), format='markdown')\n```\n\n::: {.cell-output-display}\n|BinID         |geneID              | count|ClusterName | NrGenomes|\n|:-------------|:-------------------|-----:|:-----------|---------:|\n|GCA_002494525 |GT2_Glyco_tranf_2_3 |     1|Marine (6)  |         6|\n|GCA_002494525 |GT2_Glycos_transf_2 |     2|Marine (6)  |         6|\n|GCA_002494525 |GT4                 |     2|Marine (6)  |         6|\n|GCA_002494525 |GT66                |     1|Marine (6)  |         6|\n|GCA_002494525 |GT83                |     1|Marine (6)  |         6|\n|GCA_002494525 |K00012              |     1|Marine (6)  |         6|\n:::\n:::\n\n\n\nNext, whenever we have a value higher than one, we replace it with 1. \nThat way we deal with our data like it is a presence/absence data.\nI.e. 0 = no genes present & 1 = gene present\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#convert counts to presence/absence matrix (just using 0/1) (this is needed to calculate the percentage across clusters)\nCounts_Table_long_Tax$count[Counts_Table_long_Tax$count > 1] <- 1\nkable((head(Counts_Table_long_Tax)), format='markdown')\n```\n\n::: {.cell-output-display}\n|BinID         |geneID              | count|ClusterName | NrGenomes|\n|:-------------|:-------------------|-----:|:-----------|---------:|\n|GCA_002494525 |GT2_Glyco_tranf_2_3 |     1|Marine (6)  |         6|\n|GCA_002494525 |GT2_Glycos_transf_2 |     1|Marine (6)  |         6|\n|GCA_002494525 |GT4                 |     1|Marine (6)  |         6|\n|GCA_002494525 |GT66                |     1|Marine (6)  |         6|\n|GCA_002494525 |GT83                |     1|Marine (6)  |         6|\n|GCA_002494525 |K00012              |     1|Marine (6)  |         6|\n:::\n:::\n\n\n\nNow, we can use tidyr to count of how many genomes in a cluster have a gene. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#count data and clean header\nCounts_Table_long_Tax_sum <- Counts_Table_long_Tax[,c('ClusterName', 'geneID','NrGenomes', 'count')] %>% count(ClusterName, geneID, NrGenomes, sort = FALSE)\ncolnames(Counts_Table_long_Tax_sum) <- c(\"ClusterName\", \"geneID\", \"NrGenomes\", \"quantity\")\nkable((head(Counts_Table_long_Tax_sum)), format='markdown')\n```\n\n::: {.cell-output-display}\n|ClusterName |geneID              | NrGenomes| quantity|\n|:-----------|:-------------------|---------:|--------:|\n|Aquifer (4) |GT2_Glycos_transf_2 |         4|        4|\n|Aquifer (4) |GT4                 |         4|        3|\n|Aquifer (4) |GT66                |         4|        2|\n|Aquifer (4) |GT83                |         4|        3|\n|Aquifer (4) |K00003              |         4|        2|\n|Aquifer (4) |K00008              |         4|        3|\n:::\n:::\n\n\n\nNext, we want to calculate the percentage.\nI.e. in the first example, we have 4 aquifer genomes, two of which [FeFe]_Group_C3 (=50%).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#calculate of the percentage to answer of the total genomes per cluster how many have a certain gene\n#notice: if running for your own data check here that your percentage makes sense. I.e. we do not want values above 100\nCounts_Table_long_Tax_sum$percentage <- round(Counts_Table_long_Tax_sum$quantity/Counts_Table_long_Tax_sum$NrGenomes*100, digits = 0)\nkable((head(Counts_Table_long_Tax_sum)), format='markdown')\n```\n\n::: {.cell-output-display}\n|ClusterName |geneID              | NrGenomes| quantity| percentage|\n|:-----------|:-------------------|---------:|--------:|----------:|\n|Aquifer (4) |GT2_Glycos_transf_2 |         4|        4|        100|\n|Aquifer (4) |GT4                 |         4|        3|         75|\n|Aquifer (4) |GT66                |         4|        2|         50|\n|Aquifer (4) |GT83                |         4|        3|         75|\n|Aquifer (4) |K00003              |         4|        2|         50|\n|Aquifer (4) |K00008              |         4|        3|         75|\n:::\n:::\n\n\n\nFor printing this, we want to convert our long to a wide table by using ``spread()``.\nAlso, we want our geneIDs to be the new rownames and we do this by using the ``rownames()`` functions.\nWe do this since some functions do not like to have characters in their dataframe.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#convert long to wide format and clean table (i.e. place the rownames)\nCounts_Table_long_Tax_sum_wide <- spread(Counts_Table_long_Tax_sum[,c(\"geneID\", \"ClusterName\", \"percentage\")], ClusterName, percentage)\n\n#change the rownames\nrownames(Counts_Table_long_Tax_sum_wide) <- Counts_Table_long_Tax_sum_wide$geneID\n\n#view data\nkable((head(Counts_Table_long_Tax_sum_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    |geneID              | Aquifer (4)| Basal (2)| Clade1 (11)| Clade2 (23)| Marine (6)|\n|:-------------------|:-------------------|-----------:|---------:|-----------:|-----------:|----------:|\n|CBM44               |CBM44               |          NA|        NA|          18|          NA|         NA|\n|CE4                 |CE4                 |          NA|        50|          NA|          NA|         NA|\n|GH119               |GH119               |          NA|        NA|          NA|          52|         NA|\n|GH130               |GH130               |          NA|        50|          NA|          NA|         NA|\n|GH95                |GH95                |          NA|        50|          NA|          NA|         NA|\n|GT2_Glyco_tranf_2_3 |GT2_Glyco_tranf_2_3 |          NA|        NA|          NA|          NA|         83|\n:::\n:::\n\n\n\nWhen we change the rownames and view the data, we see that the geneID is now both in the rownames as well as the first column. \nSince that is a bit messy, we next remove the first column.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#delete the first column\nCounts_Table_long_Tax_sum_wide <- Counts_Table_long_Tax_sum_wide[,-1]\nkable((head(Counts_Table_long_Tax_sum_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    | Aquifer (4)| Basal (2)| Clade1 (11)| Clade2 (23)| Marine (6)|\n|:-------------------|-----------:|---------:|-----------:|-----------:|----------:|\n|CBM44               |          NA|        NA|          18|          NA|         NA|\n|CE4                 |          NA|        50|          NA|          NA|         NA|\n|GH119               |          NA|        NA|          NA|          52|         NA|\n|GH130               |          NA|        50|          NA|          NA|         NA|\n|GH95                |          NA|        50|          NA|          NA|         NA|\n|GT2_Glyco_tranf_2_3 |          NA|        NA|          NA|          NA|         83|\n:::\n:::\n\n\n\nNow we see that we have NAs for genes that are not present in some of our clades.\nIf we want to do more math then NAs are not helpful and we instead want to have a 0 there instead.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#replace NAs with 0\nCounts_Table_long_Tax_sum_wide[is.na(Counts_Table_long_Tax_sum_wide)] <- 0\nkable((head(Counts_Table_long_Tax_sum_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    | Aquifer (4)| Basal (2)| Clade1 (11)| Clade2 (23)| Marine (6)|\n|:-------------------|-----------:|---------:|-----------:|-----------:|----------:|\n|CBM44               |           0|         0|          18|           0|          0|\n|CE4                 |           0|        50|           0|           0|          0|\n|GH119               |           0|         0|           0|          52|          0|\n|GH130               |           0|        50|           0|           0|          0|\n|GH95                |           0|        50|           0|           0|          0|\n|GT2_Glyco_tranf_2_3 |           0|         0|           0|           0|         83|\n:::\n:::\n\n\n\nFinally, we want to sort our data, starting with the Basal clade and ending with the Black Sea Clades\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#sort by cluster order (defined by the order of the mapping file)\nCounts_Table_long_Tax_sum_wide <- Counts_Table_long_Tax_sum_wide[,Cluster_order]\nkable((head(Counts_Table_long_Tax_sum_wide)), format='markdown')\n```\n\n::: {.cell-output-display}\n|                    | Basal (2)| Aquifer (4)| Marine (6)| Clade1 (11)| Clade2 (23)|\n|:-------------------|---------:|-----------:|----------:|-----------:|-----------:|\n|CBM44               |         0|           0|          0|          18|           0|\n|CE4                 |        50|           0|          0|           0|           0|\n|GH119               |         0|           0|          0|           0|          52|\n|GH130               |        50|           0|          0|           0|           0|\n|GH95                |        50|           0|          0|           0|           0|\n|GT2_Glyco_tranf_2_3 |         0|           0|         83|           0|           0|\n:::\n:::\n\n\n\n\n## Merge our tables with the mapping data we have\n\nNow, that we have our count tables both for the bins as well as for all the clusters, we now want to add some gene description and subset the data based on different categores.\n\n### For the bins\n\n#### Add gene descriptions\n\nRemember above, we made a list of descriptions that links all geneIDs with what is behind all the gene IDs? Now we want to add this info back in in order to print all the counts.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merge\nCounts_Table_final <- merge(All_Genes_Description, Counts_Table_wide, by.x=\"Gene\", by.y=\"row.names\", all.x = T, sort = F)\nkable((head(Counts_Table_final)), format='markdown')\n```\n\n::: {.cell-output-display}\n|Gene       |Description                                               | NIOZ132_cc_b51_2| NIOZ134_mx_b281_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| GCA_002494525| GCA_002495465| GCA_002501985| SRR4028224_bin17| SRR5007147_bin71| U_76725| NIOZ124_cc_b247_2| NIOZ125_mb_b254_2| NIOZ129_mb_b262_2| NIOZ126_mb_b401_2| NIOZ122_mb_b319_2| NIOZ134_mb_b41_2| NIOZ132_mb_b282_2| NIOZ127_mb_b161_2| NIOZ123_bs_b5_2| NIOZ121_cc_b94_2| NIOZ136_cc_b15_2| GCA_002502135| NIOZ134_mb_b293_2| NIOZ132_mb_b260_2| NIOZ126_mb_b137_2| NIOZ129_mb_b254_2| NIOZ127_mb_b282_2| NIOZ122_mb_b305_2| NIOZ136_mb_b335_2| NIOZ132_mb_b198_2| NIOZ136_mb_b104_2| NIOZ125_mb_b178_2| NIOZ121_mb_b48_2| NIOZ134_cc_b149_2| NIOZ134_mb_b361_2| NIOZ136_mb_b226_2| NIOZ123_bs_b392_2| NIOZ124_mb_b130_2| NIOZ132_cc_b149_2| NIOZ125_cc_b75_2| NIOZ132_mx_b314_2| NIOZ120_mb_b229_2| NIOZ126_mb_b304_2| NIOZ119_mb_b5_2|\n|:----------|:---------------------------------------------------------|----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|-------------:|-------------:|-------------:|----------------:|----------------:|-------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|---------------:|----------------:|----------------:|-------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|\n|arCOG00570 |\"Geranylgeranyl_reductase,_flavoprotein\"                  |                2|                 4|                  3|                 1|                  3|                  2|             1|             1|             1|                1|                1|       1|                 2|                 3|                 3|                 3|                 2|                3|                 3|                 3|               3|                2|                1|             1|                 2|                 1|                 1|                 0|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 2|                 1|                 1|                 2|                1|                 1|                 1|                 1|               1|\n|arCOG01358 |2-methylthioadenine_synthetase                            |                1|                 2|                  0|                 1|                  0|                  1|             0|             0|             0|                0|                0|       0|                 0|                 1|                 1|                 1|                 1|                1|                 1|                 1|               1|                1|                0|             1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 2|                 1|                 1|                 0|                 1|                 1|                1|                 1|                 1|                 1|               1|\n|arCOG01169 |Enolase                                                   |                1|                 1|                  0|                 1|                  1|                  1|             1|             1|             1|                1|                1|       0|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|               1|                0|                1|             1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                0|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 1|               1|\n|arCOG04245 |Ribosomal_protein_S2                                      |                1|                 0|                  0|                 1|                  1|                  1|             1|             1|             1|                1|                1|       0|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|               1|                0|                1|             1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                0|                 0|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 1|               1|\n|arCOG01728 |\"Predicted_class_III_extradiol_dioxygenase,_MEMO1_family\" |                2|                 0|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 1|                 1|                 1|                 1|                 1|                1|                 2|                 1|               1|                0|                0|             1|                 1|                 1|                 0|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                0|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 0|               1|\n|arCOG00546 |mRNA_degradation_ribonuclease_J1/J2                       |                1|                 0|                  0|                 0|                  1|                  0|             1|             0|             1|                1|                1|       1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|               1|                1|                1|             1|                 0|                 0|                 0|                 0|                 0|                 0|                 1|                 0|                 0|                 1|                0|                 2|                 0|                 1|                 0|                 1|                 1|                0|                 1|                 1|                 0|               1|\n:::\n\n```{.r .cell-code}\n#print (and beautify elsewhere)\nwrite.table(Counts_Table_final, \"../output_examples/Counts_Table_final.txt\",  sep = \"\\t\", quote = F, row.names = T, na = \"\")\n```\n:::\n\n\n\n\n#### Merging with the arcog_table\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merge\nArcog_Data <- merge(Arcog_mapping, Counts_Table_wide, by.x=\"arcog\", by.y=\"row.names\", all.x = T, sort = F)\nkable((head(Arcog_Data)), format='markdown')\n```\n\n::: {.cell-output-display}\n|arcog      |Pathway |GeneID |Gene                                                                      |COG      |PFAM                  |CD      |TIGR                  | NIOZ132_cc_b51_2| NIOZ134_mx_b281_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| GCA_002494525| GCA_002495465| GCA_002501985| SRR4028224_bin17| SRR5007147_bin71| U_76725| NIOZ124_cc_b247_2| NIOZ125_mb_b254_2| NIOZ129_mb_b262_2| NIOZ126_mb_b401_2| NIOZ122_mb_b319_2| NIOZ134_mb_b41_2| NIOZ132_mb_b282_2| NIOZ127_mb_b161_2| NIOZ123_bs_b5_2| NIOZ121_cc_b94_2| NIOZ136_cc_b15_2| GCA_002502135| NIOZ134_mb_b293_2| NIOZ132_mb_b260_2| NIOZ126_mb_b137_2| NIOZ129_mb_b254_2| NIOZ127_mb_b282_2| NIOZ122_mb_b305_2| NIOZ136_mb_b335_2| NIOZ132_mb_b198_2| NIOZ136_mb_b104_2| NIOZ125_mb_b178_2| NIOZ121_mb_b48_2| NIOZ134_cc_b149_2| NIOZ134_mb_b361_2| NIOZ136_mb_b226_2| NIOZ123_bs_b392_2| NIOZ124_mb_b130_2| NIOZ132_cc_b149_2| NIOZ125_cc_b75_2| NIOZ132_mx_b314_2| NIOZ120_mb_b229_2| NIOZ126_mb_b304_2| NIOZ119_mb_b5_2|\n|:----------|:-------|:------|:-------------------------------------------------------------------------|:--------|:---------------------|:-------|:---------------------|----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|-------------:|-------------:|-------------:|----------------:|----------------:|-------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|---------------:|----------------:|----------------:|-------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|\n|arCOG00009 |E       |PotE   |Amino acid transporter                                                    |COG00531 |pfam00324             |        |TIGR00909             |                2|                 4|                  1|                 1|                  1|                  1|             2|             1|             2|                1|                1|       1|                 3|                 3|                 2|                 1|                 3|                3|                 3|                 3|               2|                1|                0|             1|                 1|                 2|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 2|                 1|                 1|                 1|                1|                 0|                 1|                 1|               0|\n|arCOG00014 |G       |RbsK   |\"Sugar kinase, ribokinase family\"                                         |COG00524 |pfam00294             |cd01174 |TIGR02152             |                1|                 2|                  1|                 2|                  1|                  2|             2|             2|             2|                2|                2|       2|                 2|                 3|                 2|                 2|                 2|                3|                 2|                 2|               2|                2|                2|             3|                 1|                 2|                 2|                 3|                 2|                 4|                 2|                 2|                 2|                 2|                3|                 2|                 2|                 3|                 2|                 4|                 1|                2|                 2|                 2|                 2|               1|\n|arCOG00017 |R       |-      |Predicted transcriptional regulator                                       |COG02522 |                      |        |                      |                1|                 1|                  0|                 0|                  0|                  0|             1|             1|             1|                1|                1|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 1|                 0|                 0|               0|\n|arCOG00018 |F       |Nnr2   |\"NAD(P)H-hydrate repair enzyme Nnr, NAD(P)H-hydrate dehydratase domain\"   |COG00063 |\"pfam03853,pfam01256\" |cd01171 |\"TIGR00197,TIGR00196\" |                1|                 1|                  1|                 0|                  1|                  0|             1|             1|             1|                2|                2|       0|                 1|                 1|                 1|                 1|                 1|                1|                 0|                 2|               1|                2|                1|             2|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 0|                 1|                1|                 2|                 0|                 2|                 1|                 1|                 1|                0|                 0|                 1|                 0|               0|\n|arCOG00029 |F       |PyrE   |Orotate phosphoribosyltransferase                                         |COG00461 |pfam00156             |cd06223 |TIGR00336             |                1|                 0|                  1|                 0|                  1|                  0|             1|             1|             1|                1|                1|       1|                 1|                 1|                 0|                 0|                 0|                1|                 1|                 1|               1|                0|                0|             0|                 0|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 1|                 1|                 1|                 1|                 1|                 1|                1|                 0|                 0|                 0|               1|\n|arCOG00030 |F       |Apt    |Adenine/guanine phosphoribosyltransferase or related PRPP-binding protein |COG00503 |pfam00156             |cd06223 |TIGR01090             |                0|                 1|                  2|                 1|                  1|                  1|             1|             1|             1|                1|                1|       1|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             1|                 0|                 1|                 2|                 2|                 1|                 2|                 1|                 2|                 2|                 2|                2|                 1|                 2|                 0|                 2|                 2|                 1|                0|                 1|                 1|                 0|               1|\n:::\n\n```{.r .cell-code}\n#print (and beautify elsewhere)\nwrite.table(Arcog_Data, \"../output_examples/ArCOG_Data.txt\",  sep = \"\\t\", quote = F, row.names = T, na = \"\")\n```\n:::\n\n\n\n\n#### Merging with the metabolism metadata file\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merge\nKEGG_Metabolism <- merge(Metabolism_file_KEGG, Counts_Table_wide, by.x=\"KO\", by.y=\"row.names\", all.x = T, sort = F)\nkable((head(KEGG_Metabolism)), format='markdown')\n```\n\n::: {.cell-output-display}\n|KO        |IDs  |pathway_A  |order |Gene                                                       |Comment.Uniprot.comment | NIOZ132_cc_b51_2| NIOZ134_mx_b281_2| SRR2090153_bin1042| SRR2090153_bin461| SRR2090159_bin1129| SRR2090159_bin1288| GCA_002494525| GCA_002495465| GCA_002501985| SRR4028224_bin17| SRR5007147_bin71| U_76725| NIOZ124_cc_b247_2| NIOZ125_mb_b254_2| NIOZ129_mb_b262_2| NIOZ126_mb_b401_2| NIOZ122_mb_b319_2| NIOZ134_mb_b41_2| NIOZ132_mb_b282_2| NIOZ127_mb_b161_2| NIOZ123_bs_b5_2| NIOZ121_cc_b94_2| NIOZ136_cc_b15_2| GCA_002502135| NIOZ134_mb_b293_2| NIOZ132_mb_b260_2| NIOZ126_mb_b137_2| NIOZ129_mb_b254_2| NIOZ127_mb_b282_2| NIOZ122_mb_b305_2| NIOZ136_mb_b335_2| NIOZ132_mb_b198_2| NIOZ136_mb_b104_2| NIOZ125_mb_b178_2| NIOZ121_mb_b48_2| NIOZ134_cc_b149_2| NIOZ134_mb_b361_2| NIOZ136_mb_b226_2| NIOZ123_bs_b392_2| NIOZ124_mb_b130_2| NIOZ132_cc_b149_2| NIOZ125_cc_b75_2| NIOZ132_mx_b314_2| NIOZ120_mb_b229_2| NIOZ126_mb_b304_2| NIOZ119_mb_b5_2|\n|:---------|:----|:----------|:-----|:----------------------------------------------------------|:-----------------------|----------------:|-----------------:|------------------:|-----------------:|------------------:|------------------:|-------------:|-------------:|-------------:|----------------:|----------------:|-------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|---------------:|----------------:|----------------:|-------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|-----------------:|----------------:|-----------------:|-----------------:|-----------------:|---------------:|\n|K00362    |ID14 |Nitrogen   |N2    |nirB; nitrite reductase (NADH) large subunit [EC:1.7.1.15] |Dissimilatory           |                0|                 1|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|TIGR02374 |ID15 |Nitrogen   |N2    |\"NirB, nitrite reductase [NAD(P)H]\"                        |Dissimilatory           |                0|                 2|                  0|                 0|                  0|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|TIGR02378 |ID17 |Nitrogen   |N2    |\"NirD, nitrite reductase [NAD(P)H]\"                        |Dissimilatory           |                0|                 1|                  0|                 1|                  1|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|K04748    |ID31 |no_pathway |      |norQ; nitric oxide reductase NorQ protein                  |                        |                0|                 0|                  0|                 0|                  1|                  0|             0|             0|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|K00376    |ID36 |Nitrogen   |N5    |nosZ; nitrous-oxide reductase [EC:1.7.2.4]                 |                        |                0|                 0|                  0|                 0|                  0|                  0|             0|             1|             0|                0|                0|       0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n|TIGR04246 |ID37 |Nitrogen   |N5    |\"nosZ,  nitrous-oxide reductase, Sec-dependent\"            |                        |                0|                 0|                  0|                 0|                  0|                  0|             1|             1|             0|                1|                1|       1|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|               0|                0|                0|             0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|                 0|                 0|                 0|                0|                 0|                 0|                 0|               0|\n:::\n\n```{.r .cell-code}\n#print\nwrite.table(KEGG_Metabolism, \"../output_examples/KEGG_Metabolism.txt\",  sep = \"\\t\", quote = F, row.names = T, na = \"\")\n```\n:::\n\n\n\n\n### For the clusters\n\nThe process works exactly the same as above. So try by yourself if you can merge things ;-).\n\n\n\n\n## Plot the data for our genes of interest\n\nHere, we are not interested in plotting all genes but just want to plot things that are listed under the lipid pathway. \n\nSince we are only interested in the Lipid pathway for the genes of interest (the table, among others, also lists genes involved in informational processing),\nwe first need to make a gene list of just the genes we are interested in.\n\nNew functions:\n\n- ``subset()`` = subsets a dataframe. Syntax --> subset(dataframe, column, %in% pattern_we_look_for)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#subset genes of interest and clean factors\nGenes_Lipids <- subset(Genes_of_interest, Pathway_1 %in% \"Lipids\")\nGenes_Lipids$Gene <- factor(Genes_Lipids$Gene)\nGenes_Lipids$arcog <- factor(Genes_Lipids$arcog)\n\n#check how many genes we have\ndim(Genes_Lipids)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 16 12\n```\n:::\n\n```{.r .cell-code}\nkable((head(Genes_Lipids)), format='markdown')\n```\n\n::: {.cell-output-display}\n|    |Pathway_1 |pathway_2  |arcog      |xx |Pathway |Gene_short |Gene_name                                                            |Comment                                                                                                                                                          |Gene  |Order   | Order2|Other |\n|:---|:---------|:----------|:----------|:--|:-------|:----------|:--------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----|:-------|------:|:-----|\n|262 |Lipids    |Mevalonate |arCOG01767 |NA |I       |HmgB       |3-hydroxy-3-methylglutaryl CoA synthase                              |Catalyzes the condensation of acetyl-CoA with acetoacetyl-CoA to form 3-hydroxy-3-methylglutaryl-CoA (HMG-CoA). Functions in the mevalonate (MVA) pathway        |HmgB  |Lipid_1 |    262|      |\n|263 |Lipids    |Mevalonate |arCOG04260 |NA |I       |HmgA       |\"3-hydroxy-3-methylglutaryl-coenzyme A reductase, HMG-CoA reductase\" |Catalyzes the NADPH-dependent reductive deacylation of (S)-3-hydroxy-3-methylglutaryl-CoA (HMG-CoA) to (R)-mevalonate. Functions in the mevalonate (MVA) pathway |HmgA  |Lipid_1 |    263|      |\n|264 |Lipids    |Mevalonate |arCOG01028 |NA |I       |MvK        |Mevalonate kinase                                                    |Catalyzes the phosphorylation of (R)-mevalonate (MVA) to (R)-mevalonate 5-phosphate (MVAP).                                                                      |MvK   |Lipid_1 |    264|      |\n|265 |Lipids    |Mevalonate |K18689     |NA |I       |M3k        |Mevalonate 3-kinase                                                  |Catalyzes the phosphorylation of mevalonate (MVA) to yield mevalonate-3-phosphate. Functions in an alternative mevalonate pathway                                |M3k   |Lipid_1 |    265|      |\n|266 |Lipids    |Mevalonate |arCOG01967 |NA |I       |M3P5K      |Mevalonate-3-phosphate 5-kinase                                      |\"Phosphorylates mevalonate 3-phosphate to form mevalonate 3,5-bisphosphate. Functions in an alternative mevalonate pathway\"                                      |M3P5K |Lipid_1 |    266|      |\n|267 |Lipids    |Mevalonate |arCOG02937 |NA |I       |mvaD       |Diphosphomevalonate decarboxylase                                    |Catalyzes the decarboxylation of mevalonate 5-phosphate (MVAP) to isopentenyl phosphate (IP). Functions in the mevalonate (MVA) pathway leading to IPP           |mvaD  |Lipid_1 |    267|      |\n:::\n:::\n\n\n\nNext, we want to make sure that the order is ok. In this specific example, we manually defined two columns for ordering (Order and Order2). \nWe sort based on these columns and make a vector to order our genes of interest and our pathways of interest.\nFor the lipid genes we look at the mevalonate pathway and general lipid biosynthesis genes\n\n- ``length()``` - lets us check the length of a vector, here it allows us to see that we would expect 16 genes\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define an order (we arange the dataframe based on two columsn, Order and Order2)\nGenes_Lipids_order_temp <- Genes_Lipids %>% arrange(Order, Order2)\nGenes_Lipids_order <- as.character(unique(Genes_Lipids_order_temp$Gene))\nlength(Genes_Lipids_order)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 16\n```\n:::\n\n```{.r .cell-code}\nGenes_Lipids_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"HmgB\"          \"HmgA\"          \"MvK\"           \"M3k\"          \n [5] \"M3P5K\"         \"mvaD\"          \"Ipk\"           \"GFPS\"         \n [9] \"EgsA\"          \"GGGP_synthase\" \"UbiA\"          \"GGR\"          \n[13] \"CarS\"          \"PgsA\"          \"ASS\"           \"Asd\"          \n```\n:::\n\n```{.r .cell-code}\n#The lipids belong to two different pathways, these 2 pathways we want to show in two separate heatmaps\nLipids_Pathway_order <- as.character(unique(Genes_Lipids$pathway_2))\nLipids_Pathway_order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Mevalonate\" \"Lipids\"    \n```\n:::\n:::\n\n\n\nNow that we know what genes we are interested in, lets subset our original count table.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#subset our original count table for genes of interest and clean factors\nGenes_Lipids_counts <- subset(Counts_Table_long_Tax_sum, geneID %in% as.character(Genes_Lipids$arcog))\nGenes_Lipids_counts$geneID <- factor(Genes_Lipids_counts$geneID)\n\n#control that all went fine\nlength(unique(Genes_Lipids_counts$geneID))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 15\n```\n:::\n\n```{.r .cell-code}\ndim(Genes_Lipids_counts)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 60  5\n```\n:::\n\n```{.r .cell-code}\nkable((head(Genes_Lipids_counts)), format='markdown')\n```\n\n::: {.cell-output-display}\n|     |ClusterName |geneID     | NrGenomes| quantity| percentage|\n|:----|:-----------|:----------|---------:|--------:|----------:|\n|1924 |Aquifer (4) |arCOG00476 |         4|        4|        100|\n|1947 |Aquifer (4) |arCOG00570 |         4|        4|        100|\n|1967 |Aquifer (4) |arCOG00670 |         4|        3|         75|\n|1968 |Aquifer (4) |arCOG00671 |         4|        4|        100|\n|1997 |Aquifer (4) |arCOG00860 |         4|        3|         75|\n|2032 |Aquifer (4) |arCOG00982 |         4|        3|         75|\n:::\n:::\n\n\n\nWith length we see that now we just have 15 genes. How can we find out what gene is missing?\n\n- ``setdiff()`` = we compare two vectors and print the elements that differ.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetdiff(Genes_Lipids$arcog, Genes_Lipids_counts$geneID)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"K18689\"\n```\n:::\n:::\n\n\n\nWe can see that we miss K18689. If we check our original annotations input, we can see that K18689 does not exist in that table. So we can nout pull information because of that.\nThis gives a good example, why it is important to check your data as we do not know whether this is an issue with the code or what the problem could be.\n\n-------\n\nNow, since our count data does not know that we categorize our different genes into different pathways, lets add this info in with ``merge()`` \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#add in metadata (from the pathway info)\nKey_Lipids_genes_cluster <- merge(Genes_Lipids_counts, Genes_Lipids, by.x =\"geneID\", by.y = 'arcog' , all.x = T )\nkable((head(Key_Lipids_genes_cluster)), format='markdown')\n```\n\n::: {.cell-output-display}\n|geneID     |ClusterName | NrGenomes| quantity| percentage|Pathway_1 |pathway_2 |xx |Pathway |Gene_short |Gene_name                                                                |Comment                                                                                                                                       |Gene |Order   | Order2|Other |\n|:----------|:-----------|---------:|--------:|----------:|:---------|:---------|:--|:-------|:----------|:------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------|:----|:-------|------:|:-----|\n|arCOG00476 |Aquifer (4) |         4|        4|        100|Lipids    |Lipids    |NA |L       |UbiA       |geranylgeranylglycerol-phosphate geranylgeranyltransferase [EC:2.5.1.42] |Notice: only the homologs identified in the aquifer MAGs harbor the characteristic DGGGP synthase domain (IPR023547)                          |UbiA |Lipid_2 |    272|      |\n|arCOG00476 |Basal (2)   |         2|        2|        100|Lipids    |Lipids    |NA |L       |UbiA       |geranylgeranylglycerol-phosphate geranylgeranyltransferase [EC:2.5.1.42] |Notice: only the homologs identified in the aquifer MAGs harbor the characteristic DGGGP synthase domain (IPR023547)                          |UbiA |Lipid_2 |    272|      |\n|arCOG00476 |Clade1 (11) |        11|       11|        100|Lipids    |Lipids    |NA |L       |UbiA       |geranylgeranylglycerol-phosphate geranylgeranyltransferase [EC:2.5.1.42] |Notice: only the homologs identified in the aquifer MAGs harbor the characteristic DGGGP synthase domain (IPR023547)                          |UbiA |Lipid_2 |    272|      |\n|arCOG00476 |Marine (6)  |         6|        6|        100|Lipids    |Lipids    |NA |L       |UbiA       |geranylgeranylglycerol-phosphate geranylgeranyltransferase [EC:2.5.1.42] |Notice: only the homologs identified in the aquifer MAGs harbor the characteristic DGGGP synthase domain (IPR023547)                          |UbiA |Lipid_2 |    272|      |\n|arCOG00476 |Clade2 (23) |        23|       19|         83|Lipids    |Lipids    |NA |L       |UbiA       |geranylgeranylglycerol-phosphate geranylgeranyltransferase [EC:2.5.1.42] |Notice: only the homologs identified in the aquifer MAGs harbor the characteristic DGGGP synthase domain (IPR023547)                          |UbiA |Lipid_2 |    272|      |\n|arCOG00570 |Clade2 (23) |        23|       22|         96|Lipids    |Lipids    |NA |L       |GGR        |digeranylgeranylglycerophospholipid reductase [EC:1.3.1.101 1.3.7.11]    |\"reduction of 2,3-digeranylgeranylglycerophospholipids (unsaturated archaeols) into 2,3-diphytanylglycerophospholipids (saturated archaeols)\" |GGR  |Lipid_2 |    273|      |\n:::\n:::\n\n\n\n### Categorizing data\n\n There are different ways to color code data. By default the way we do it, we use a gradual color scale from 0-100%. \n However, we could also define categories with the ifelse statement we learned before.\n Here, we define 4 categories (100%, 75-100 and, 33-75 and 0-33%)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define color code (not used for the current figure, but can be changed)\n#here , we define 3 color levels, which sometimes is useful to show very clear cutoffs\nKey_Lipids_genes_cluster$category <- ifelse(Key_Lipids_genes_cluster$percentage == 100, \"1\",\n                                         ifelse(Key_Lipids_genes_cluster$percentage >= 75, \"0.75\",\n                                                ifelse(Key_Lipids_genes_cluster$percentage >= 33, \"0.33\", \"0\")))\n```\n:::\n\n\n\n### Order our data\n\nRemember the annoying thing that R sorts alphabetically? \nLet's make sure we ahve the order we want.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define order for the plot\nKey_Lipids_genes_cluster$ClusterName2 <-  factor(Key_Lipids_genes_cluster$ClusterName, levels = rev(Cluster_order))\nKey_Lipids_genes_cluster$Gene2 <-  factor(Key_Lipids_genes_cluster$Gene, levels = Genes_Lipids_order)\nKey_Lipids_genes_cluster$pathway_2b <-  factor(Key_Lipids_genes_cluster$pathway_2, levels = Lipids_Pathway_order)\n```\n:::\n\n\n\n### Plotting\n\nIn the example here, we use a gradual scale. If we would want to use our 4 categories we can use this code ``#scale_fill_manual(values= c(\"white\", \"blue\", \"blue\", \"dodgerblue\"))``\nand replacing the ``fill = percentage `` with ``fill = category ``. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot\np1_Lipids <- \n  ggplot(Key_Lipids_genes_cluster, aes(x=Gene2, y=ClusterName2)) + \n  geom_tile(aes(fill = percentage)) +\n  geom_hline(yintercept=2.5) +\n  facet_wrap( ~ pathway_2b, nrow = 1, scales='free_x') +\n  scale_fill_distiller(palette = \"Blues\", direction = 1) +\n  theme_bw() +\n  #scale_fill_manual(values= c(\"white\", \"blue\", \"blue\", \"dodgerblue\")) +\n  labs(x=\"\", y=\"\", fill=\"Percentage\") + \n  theme(panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(), \n        axis.line = element_line(colour = \"black\")) +\n  theme(legend.position=\"left\",\n        axis.text.x=element_text(angle=45,vjust = 1, hjust=1, size=8),\n        #axis.text.y=element_blank(),\n        axis.ticks=element_blank(),\n        axis.line=element_blank(),\n        plot.margin=unit(c(0, 0, 0, 0), \"mm\"))\n\np1_Lipids\n```\n\n::: {.cell-output-display}\n![](parsing_output_from_annotations_files/figure-pdf/unnamed-chunk-40-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nas.data.frame(levels(Key_Lipids_genes_cluster$ClusterName2))\n```\n\n::: {.cell-output-display}\n\\begin{tabular}{l}\n\\hline\nlevels(Key\\_Lipids\\_genes\\_cluster\\$ClusterName2)\\\\\n\\hline\nClade2 (23)\\\\\n\\hline\nClade1 (11)\\\\\n\\hline\nMarine (6)\\\\\n\\hline\nAquifer (4)\\\\\n\\hline\nBasal (2)\\\\\n\\hline\n\\end{tabular}\n:::\n\n```{.r .cell-code}\np1_Lipids2 <- \n  ggplot(Key_Lipids_genes_cluster, aes(x=Gene2, y=ClusterName2)) + \n  geom_tile(aes(fill = percentage)) +\n  geom_hline(yintercept=2.5) +\n  facet_wrap( ~ pathway_2b, nrow = 1, scales='free_x') +\n  scale_fill_distiller(palette = \"Blues\", direction = 1) +\n  theme_bw() +\n  #scale_fill_manual(values= c(\"white\", \"blue\", \"blue\", \"dodgerblue\")) +\n  labs(x=\"\", y=\"\", fill=\"Percentage\") + \n  theme(panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(), \n        axis.line = element_line(colour = \"black\")) +\n  theme(legend.position=\"left\",\n        axis.text.x=element_text(angle=45,vjust = 1, hjust=1, size=8),\n        #axis.text.y=element_blank(),\n        axis.ticks=element_blank(),\n        axis.line=element_blank(),\n        plot.margin=unit(c(0, 0, 0, 0), \"mm\"))\n\np1_Lipids2\n```\n\n::: {.cell-output-display}\n![](parsing_output_from_annotations_files/figure-pdf/unnamed-chunk-40-2.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nIf we plot with facets we can sometimes have the problem that different genes have different widths.\nWe can correct this behaviour with ggplotGrob.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert ggplot object to grob object (used to rescale plot)\ngp_lipid <- ggplotGrob(p1_Lipids2)\n\n# optional: take a look at the grob object's layout\ngtable::gtable_show_layout(gp_lipid)\n\n# get gtable columns corresponding to the facets (5 & 9, in this case)\nfacet.columns <- gp_lipid$layout$l[grepl(\"panel\", gp_lipid$layout$name)]\n\n# get the number of unique x-axis values per facet (1 & 3, in this case)\nx.var <- sapply(ggplot_build(p1_Lipids)$layout$panel_scales_x,\n                function(l) length(l$range$range))\n\n# change the relative widths of the facet columns based on\n# how many unique x-axis values are in each facet\ngp_lipid$widths[facet.columns] <- gp_lipid$widths[facet.columns] * x.var\n\n# plot result\ngrid::grid.draw(gp_lipid)\n```\n\n::: {.cell-output-display}\n![](parsing_output_from_annotations_files/figure-pdf/unnamed-chunk-41-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n#print\n#pdf(\"2_Output/Figure_S64.pdf\", paper=\"special\", family=\"sans\",width=8, height=7, useDingbats=FALSE)\n#grid::grid.draw(gp_lipid)\n#dev.off() \n```\n:::\n\n\n\nIn this example we see that only the aquifer and the basal clade have all required genes for the mevalonate pathway and the lipid pathway that is required to make a key archaeal lipid.\n\n",
    "supporting": [
      "parsing_output_from_annotations_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}