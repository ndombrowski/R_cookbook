{
  "hash": "9558fcc5593683d3f281c5258d0be379",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute:\n    eval: true\n\ndf-print: paged\n---\n\n\n\n\n\n\n\n# Statistics in R\n\n\nA lot of helpful information that that was used here was inspired by a more detailed site that can be found [here](http://www.learnbymarketing.com/tutorials/linear-regression-in-r/)\n\nAnd please take note, that the writer of this tutorial is no statistician and if you spot issues feel free to let me know!\n\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\n\n## Summary stats\n\nTo do some basic stats we use the nutrient growth data set, which you find in the R_exercises folder. \n\n- ``means()`` = print the mean of a certain column\n- ``summary()``= print the mean, median, max, min, ... of a certain column.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#get the menas of our root length\nmean(growth_data$Rootlength)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 9.046117\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#return summary stats for the root length\nsummary(growth_data$Rootlength)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  4.236   6.721   8.099   9.046  11.793  14.716 \n```\n\n\n:::\n:::\n\n\n\n\n\n\nWe can also summarize data of several columns\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#return summary stats for the root length\nsummary(growth_data[,c(\"Rootlength\", \"FW_shoot_mg\")])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Rootlength      FW_shoot_mg   \n Min.   : 4.236   Min.   : 3.75  \n 1st Qu.: 6.721   1st Qu.: 7.69  \n Median : 8.099   Median :11.62  \n Mean   : 9.046   Mean   :15.23  \n 3rd Qu.:11.793   3rd Qu.:22.05  \n Max.   :14.716   Max.   :39.39  \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\nWe can also run ``summary()`` on our complete dataframe.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#run summary on all our data\nsummary(growth_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   SampleID           Nutrient          Condition          FW_shoot_mg   \n Length:105         Length:105         Length:105         Min.   : 3.75  \n Class :character   Class :character   Class :character   1st Qu.: 7.69  \n Mode  :character   Mode  :character   Mode  :character   Median :11.62  \n                                                          Mean   :15.23  \n                                                          3rd Qu.:22.05  \n                                                          Max.   :39.39  \n   Rootlength    \n Min.   : 4.236  \n 1st Qu.: 6.721  \n Median : 8.099  \n Mean   : 9.046  \n 3rd Qu.:11.793  \n Max.   :14.716  \n```\n\n\n:::\n:::\n\n\n\n\n\n\nThis way we do not only get summary stats for our values, but also we get some counts on how many measurements we have for different conditions.\n\n\n## The table command\n\nThe function table builds a contingency table of the counts at each factor level, or combinations of factor levels. This is quite useful to count the number of data points with certain metadata associated. So for example for our genome data we can ask how many measurements we made for each condition.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#summarize how many measurements we have for each treatment\ntable(growth_data$SampleID)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n    noP noP_101 noP_230  noP_28       P   P_101   P_230    P_28 \n     13      13      11      15      15      12      13      13 \n```\n\n\n:::\n:::\n\n\n\n\n\n\nHere, we see that we have a slightly different number of measurements for each condition and timepoint. \nFor this tutorial we can ignore them, but this might be relevant if we have huge differences for some statistical analyses.\nThis approach allows you to for larger datasets to easily check for samples that might be outliers in terms of measurements per sample.\n\n\n## The ddply command\n\nThe table command can get rather slow and there are some useful packages to speed up things and run more complicated mathematical operations. One example is the ``ddply()`` function of the plyr package. A useful feature of ddply is that this tool stores the output as a dataframe instead of a table.\n\nBelow we see examples were we summarize the data for the root length across different nutrient conditions. \nI.e. we do not want to have the mean for all root lengths but we want to see if roots have different lengths under low and high P conditions.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load our package\nlibrary(plyr)\n\n#calculate the mean root length across our Sample IDs\ngrowth_data_summarized <- ddply(growth_data, .(Nutrient), summarize, Mean_RootLength = mean(Rootlength))\n\n#view data\nhead(growth_data_summarized)\n```\n\n::: {.cell-output-display}\n\n|Nutrient | Mean_RootLength|\n|:--------|---------------:|\n|noP      |        6.530845|\n|P        |       11.513931|\n\n:::\n:::\n\n\n\n\n\n\nThe structure of the command is as follows:\n\n**ddply(Input_Data, .(Colum_we_want_to_sum_arcoss), summarize, New_Column_name = mean(Column_we_want_to_calc_the_mean_for))**\n\nWe can also summarize the data combining different conditions (i.e. nutrient and condition).\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Summarize our data across Nutrients and Conditions\ngrowth_data_summarized <- ddply(growth_data, .(Nutrient, Condition), summarize, Mean_RootLength = mean(Rootlength))\n\n#view data\nhead(growth_data_summarized)\n```\n\n::: {.cell-output-display}\n\n|Nutrient |Condition | Mean_RootLength|\n|:--------|:---------|---------------:|\n|noP      |MgCl      |        5.805198|\n|noP      |Strain101 |        7.094616|\n|noP      |Strain230 |        7.172883|\n|noP      |Strain28  |        6.200309|\n|P        |MgCl      |        9.853457|\n|P        |Strain101 |       12.729133|\n\n:::\n:::\n\n\n\n\n\n\nWe can also calculate the mean, sd and se in one line of code\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#and we can use even fancier functions (i.e. get the se and sd), check the plyr package for more details\ngrowth_data_summarized <- ddply(growth_data, .(Nutrient, Condition), summarize, RootLength = mean(Rootlength), sd = sd (Rootlength), se = sd(Rootlength) / sqrt((length(Rootlength))))\n\n#view data\nhead(growth_data_summarized)\n```\n\n::: {.cell-output-display}\n\n|Nutrient |Condition | RootLength|        sd|        se|\n|:--------|:---------|----------:|---------:|---------:|\n|noP      |MgCl      |   5.805198| 0.7738124| 0.2146170|\n|noP      |Strain101 |   7.094616| 0.5939804| 0.1647405|\n|noP      |Strain230 |   7.172883| 0.6117203| 0.1844406|\n|noP      |Strain28  |   6.200309| 0.9988989| 0.2579146|\n|P        |MgCl      |   9.853457| 1.2981376| 0.3351777|\n|P        |Strain101 |  12.729133| 0.9813173| 0.2832819|\n\n:::\n:::\n\n\n\n\n\n\n\n## tidyr\n\nTydir is another package to summarize data but also to transform data. \nFor now we will just discuss the basics to summarize data but we will try to add an extended section on this package later.\n\nYou notice here that the syntax is a bit unusual and we use the `` %>%`` symbol (a so-called forward pipe operator).\nThis symbol is commonly used in the **dplyr** and **tidyr** packages.\nThis function passes the left hand side of the operator to the first argument of the right hand side of the operator. \n\nIn the following example, the a subset of the growth_data data (only 3 columns, not the whole dataframe) gets passed to ``count()``\n\nNew functions:\n\n- ``count()`` = A function of the dplyr package. Here, we count the unique protein IDs grouped by BinID and gene (i.e. roughly equivalent to the columns we want to keep)\n- ``summarize()`` creates new data frame into one (or more) rows for each combination of grouping variables; if there are no grouping variables, the output will have a single row summarising all observations in the input. It will contain one column for each grouping variable and one column for each of the summary statistics that you have specified.\n- ``mean()`` = calculate the  arithmetic mean.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in package\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#count how many measurements we have per conditions\ngrowth_data %>% count(Condition, sort = FALSE)\n```\n\n::: {.cell-output-display}\n\n|Condition |  n|\n|:---------|--:|\n|MgCl      | 28|\n|Strain101 | 25|\n|Strain230 | 24|\n|Strain28  | 28|\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#count how many measurements we have per nutrient and conditions\ngrowth_data %>% count(Nutrient, Condition, sort = FALSE)\n```\n\n::: {.cell-output-display}\n\n|Nutrient |Condition |  n|\n|:--------|:---------|--:|\n|P        |MgCl      | 15|\n|P        |Strain101 | 12|\n|P        |Strain230 | 13|\n|P        |Strain28  | 13|\n|noP      |MgCl      | 13|\n|noP      |Strain101 | 13|\n|noP      |Strain230 | 11|\n|noP      |Strain28  | 15|\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#get more comprehensive data stats and summarize for the whole dataset\ngrowth_data %>% summarise(\n          count = n(),\n          mean_root = mean(Rootlength, na.rm = TRUE))\n```\n\n::: {.cell-output-display}\n\n| count| mean_root|\n|-----:|---------:|\n|   105|  9.046117|\n\n:::\n:::\n\n\n\n\n\n\nGood things about tydr are:\n\n- it is extremely fast, so is important for dealing with larger datasets\n- we can combine several commands by using the pipe\n\nI.e. below we can see that we first group the input data and then summarized the group data.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#get more comprehensive data stats and summarize and grouping for the different conditions\ngrowth_data %>% \n    group_by(Nutrient, Condition) %>%  \n    summarise(\n          count = n(),\n          mean_root = mean(Rootlength, na.rm = TRUE) ,.groups = 'drop')\n```\n\n::: {.cell-output-display}\n\n|Nutrient |Condition | count| mean_root|\n|:--------|:---------|-----:|---------:|\n|P        |MgCl      |    15|  9.853457|\n|P        |Strain101 |    12| 12.729133|\n|P        |Strain230 |    13| 11.814678|\n|P        |Strain28  |    13| 12.007390|\n|noP      |MgCl      |    13|  5.805198|\n|noP      |Strain101 |    13|  7.094616|\n|noP      |Strain230 |    11|  7.172883|\n|noP      |Strain28  |    15|  6.200309|\n\n:::\n:::\n\n\n\n\n\n\nWe can also do other stats than just calculating the mean: \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#get more comprehensive data stats and summarize and grouping for the different conditions\ngrowth_data %>% \n    group_by(Nutrient, Condition) %>%  \n    summarise(\n          count = n(),\n          mean_root = mean(Rootlength, na.rm = TRUE),\n          sd_root = sd(Rootlength),.groups = 'drop')\n```\n\n::: {.cell-output-display}\n\n|Nutrient |Condition | count| mean_root|   sd_root|\n|:--------|:---------|-----:|---------:|---------:|\n|P        |MgCl      |    15|  9.853457| 1.2981376|\n|P        |Strain101 |    12| 12.729133| 0.9813173|\n|P        |Strain230 |    13| 11.814678| 0.9128499|\n|P        |Strain28  |    13| 12.007390| 0.5812310|\n|noP      |MgCl      |    13|  5.805198| 0.7738124|\n|noP      |Strain101 |    13|  7.094616| 0.5939804|\n|noP      |Strain230 |    11|  7.172883| 0.6117203|\n|noP      |Strain28  |    15|  6.200309| 0.9988989|\n\n:::\n:::\n\n\n\n\n\n\nOther useful summary functions:\n\n- `mean(x)`: sum of x divided by the length\n- `median(x)`: 50% of x is above and 50% is below\n\n- `sd(x)`: standard deviation\n- `IQR(x)`: interquartile range (robust equivalent of sd when outliers are present in the data)\n- `mad(x)`: median absolute deviation (robust equivalent of sd when outliers are present in the data)\n\n- `min(x)`: minimum value of x\n- `max(x)`: maximum value of x\n- `quantile(x, 0.25)`: 25% of x is below this value\n\n- `first(x)`: equivalent to x[1]\n- `nth(x, 2)`: equivalent to n<-2; x[n]\n- `last(x)`: equivalent to x[length(x)]\n\n- `n(x)`: the number of elements in x\n- `sum(!is.na(x))`: count non-missing values\n- `n_distinct(x)`: count the number of unique value\n\n- `sum(x > 10)`: count the number of elements where x > 10\n- `mean(y == 0)`: proportion of elements where y = 0\n\n\n\n## More stats: tapply\n\nTapply is a base R function and allows to apply a function to each cell of a ragged array, that is to each (non-empty) group of values given by a unique combination of the levels of certain factors. It can be used as an alternative to ddply.\n\nSuppose now we want to estimate the mean root length for each growth condition. Notice, how we can vary the index?\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#index = factors we want to select\ntapply(X = growth_data$Rootlength, INDEX = growth_data$Nutrient, FUN = mean,na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      noP         P \n 6.530845 11.513931 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#same but for two-way tables (this is not so useful here, but might be handy when you have different conditions for the same organism or a timecourse)\ntapply(growth_data$Rootlength, INDEX = list(growth_data$Nutrient, growth_data$Condition),FUN = mean, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        MgCl Strain101 Strain230  Strain28\nnoP 5.805198  7.094616  7.172883  6.200309\nP   9.853457 12.729133 11.814678 12.007390\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n## Linear models \n\n### Basics\n\nIt is very simple to investigate linear relationships among variables in R. We want to estimate how a quantitative dependent variable changes according to the levels of one or more categorical independent variables. In the command below, the linear relationship between Rootlength (the **dependent** variable, i.e. the one we’re trying to predict) and FW_shoot_mg (the **independent** variable or the predictor) is calculated.\n\nWe need to use the function summary to see the results of that command; coef extracts the best-fit coefficients, anova performs an analysis of variance; there are many other extractor functions.\n\nIn this case lets work with the data were we do not have to deal with the different time points to simplify things.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in data were we have several measurements\ngrowth_data <- read.table(\"../data/Growth_Data.txt\", sep=\"\\t\", header=T, fill=TRUE, quote = \"\")\n\n#is there a correlation between freshweight and root length?\nlinearmodel <- lm(Rootlength ~ FW_shoot_mg, data = growth_data)\nlinearmodel\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Rootlength ~ FW_shoot_mg, data = growth_data)\n\nCoefficients:\n(Intercept)  FW_shoot_mg  \n     5.2912       0.2465  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#let's extract the entire t-table\nsummary(linearmodel) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Rootlength ~ FW_shoot_mg, data = growth_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.5263 -0.9978 -0.0181  1.0094  3.9292 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  5.29124    0.30469   17.37   <2e-16 ***\nFW_shoot_mg  0.24648    0.01712   14.40   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.615 on 103 degrees of freedom\nMultiple R-squared:  0.6681,\tAdjusted R-squared:  0.6649 \nF-statistic: 207.4 on 1 and 103 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n\n\nHere one of the values is the model p-Value (bottom last line) and the p-Value of individual predictor variables (extreme right column under ‘Coefficients’). The p-Values are very important because, we can consider a linear model to be statistically significant only when both these p-Values are less that the pre-determined statistical significance level, which is ideally 0.05. This is visually interpreted by the significance stars at the end of the row. The more the stars beside the variable’s p-Value, the more significant the variable.\n\n* Residuals: The section summarizes the residuals, the error between the prediction of the model and the actual results.  Smaller residuals are better.\n* Coefficients: For each variable and the intercept, a weight is produced and that weight has other attributes like the standard error, a t-test value and significance.\n* Estimate: This is the weight given to the variable.  In the simple regression case (one variable plus the intercept), for every increase in root length, the model predicts an increase of 0.24.\n* Std. Error: Tells you how precisely was the estimate measured.  It’s really only useful for calculating the t-value.\n* t-value and Pr(>[t]): The t-value is calculated by taking the coefficient divided by the Std. Error.  It is then used to test whether or not the coefficient is significantly different from zero.  If it isn’t significant, then the coefficient really isn’t adding anything to the model and could be dropped or investigated further.  Pr(>|t|) is the significance level.\n\nPerformance Measures: \n\nThree sets of measurements are provided.\n\n* Residual Standard Error: This is the standard deviation of the residuals.  Smaller is better.\n* Multiple / Adjusted R-Square: For one variable, the distinction doesn’t really matter.  R-squared shows the amount of variance explained by the model.  Adjusted R-Square takes into account the number of variables and is most useful for multiple-regression.\n* F-Statistic: The F-test checks if at least one variable’s weight is significantly different than zero.  This is a global test to help asses a model.  If the p-value is not significant (e.g. greater than 0.05) than your model is essentially not doing anything.\n\nWe also can just print parts of the data:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#print only the coefficients \ncoef(summary(linearmodel))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Estimate Std. Error  t value     Pr(>|t|)\n(Intercept) 5.2912436 0.30469198 17.36588 2.278273e-32\nFW_shoot_mg 0.2464783 0.01711628 14.40023 2.039703e-26\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#print only the anova stats\nanova(linearmodel)\n```\n\n::: {.cell-output-display}\n\n|            |  Df|   Sum Sq|    Mean Sq|  F value| Pr(>F)|\n|:-----------|---:|--------:|----------:|--------:|------:|\n|FW_shoot_mg |   1| 540.9865| 540.986514| 207.3665|      0|\n|Residuals   | 103| 268.7108|   2.608842|       NA|     NA|\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot add the best line to a plot\nwith(growth_data, plot(Rootlength ~ FW_shoot_mg, col = 2))\nabline(linearmodel)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-22-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nIf we look at the stats and the p value we see a nice correlation but also that we have two distinct clusters as well as more spread in the cluster that is more to the right. These clusters likely are the two different nutrient conditions and sometimes it might make sense to separate data to get a clearer picture. Something else to consider is to ask whether the data is normally distributed and based on that what statistical test to choose.\n\n\n### Analysing residuals\n\nAnyone can fit a linear model in R. The real test is analyzing the residuals (the error or the difference between actual and predicted results).\n\nThere are four things we are looking for when analyzing residuals.\n\n- The mean of the errors is zero (and the sum of the errors is zero)\n- The distribution of the errors are normal.\n- All of the errors are independent.\n- Variance of errors is constant (Homoscedastic)\n\nIn R, you pull out the residuals by referencing the model and then the resid variable inside the model.  Using the simple linear regression model (simple.fit) we’ll plot a few graphs to help illustrate any problems with the model.\n\nBelow some examples:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimple.fit <- linearmodel\n\nlayout(matrix(c(1,1,2,3),2,2,byrow=T))\n\n#Rootlength x Residuals Plot\nplot(simple.fit$resid~growth_data$Rootlength[order(growth_data$Rootlength)],\n main=\"Rootlength x Residuals\\nfor Simple Regression\",\n xlab=\"Marketing Rootlength\", ylab=\"Residuals\")\nabline(h=0,lty=2)\n\n#Histogram of Residuals\nhist(simple.fit$resid, main=\"Histogram of Residuals\",\n ylab=\"Residuals\")\n\n#Q-Q Plot\nqqnorm(simple.fit$resid)\nqqline(simple.fit$resid)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-23-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\nThe histogram and QQ-plot are the ways to visually evaluate if the residual fit a normal distribution.\n\n- If the histogram looks like a bell-curve it might be normally distributed.\n- If the QQ-plot has the vast majority of points on or very near the line, the residuals may be normally distributed.\n\n\n## Normal distribution\n\n\n### Visualize our data via density plots\n\nThere are different ways to visualize this, one example is ggdensity of the ggpubr package.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"ggpubr\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'ggpubr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:plyr':\n\n    mutate\n```\n\n\n:::\n\n```{.r .cell-code}\n#is the data for my different variables normally distributed\nggdensity(growth_data$Rootlength)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-24-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nWe see nicely that we have two tails that likely represent the two nutrient conditions. To test this, we can simply subset the data as we have done before.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdensity(growth_data, x = \"Rootlength\",\n   add = \"mean\", rug = TRUE,\n   color = \"Nutrient\", palette = c(\"#00AFBB\", \"#E7B800\"))\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-25-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nNo we see that indeed the tool tails we see are seem to be due to our two nutrient conditions.\n\n\n### Visualize our data via Q-Q plots\n\nAnother way to represent data is in  a Q-Q plot: Q-Q plot (or quantile-quantile plot) draws the correlation between a given sample and the normal distribution. A 45-degree reference line is also plotted.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot all data\nggqqplot(growth_data$Rootlength)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-26-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot by group\nggqqplot(growth_data, x = \"Rootlength\",\n         color = \"Nutrient\",  palette = c(\"#00AFBB\", \"#E7B800\"))\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-27-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nAgain, here we see that our data for the indivdual growth conditions fit quite nicely into normal distribution.\n\n\n### Test for normality\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#for all data\nshapiro.test(growth_data$Rootlength)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  growth_data$Rootlength\nW = 0.91773, p-value = 6.744e-06\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#separate nutrient conditions\nnoP_data <- growth_data[growth_data$Nutrient == \"noP\", ]\n\n#test for noP only\nshapiro.test(noP_data$Rootlength)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  noP_data$Rootlength\nW = 0.96403, p-value = 0.1171\n```\n\n\n:::\n:::\n\n\n\n\n\n\nWe can use ddplyr and the dlookr package for doing a group-wise comparison\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(dlookr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dlookr' was built under R version 4.4.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 methods overwritten by 'dlookr':\n  method          from  \n  plot.transform  scales\n  print.transform scales\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dlookr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:tidyr':\n\n    extract\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:base':\n\n    transform\n```\n\n\n:::\n\n```{.r .cell-code}\ngrowth_data %>%\n  group_by(Nutrient) %>%\n  normality()\n```\n\n::: {.cell-output-display}\n\n|variable    |Nutrient | statistic|   p_value| sample|\n|:-----------|:--------|---------:|---------:|------:|\n|FW_shoot_mg |P        | 0.9681759| 0.1681808|     53|\n|FW_shoot_mg |noP      | 0.9831431| 0.6664909|     52|\n|Rootlength  |P        | 0.9515682| 0.0314421|     53|\n|Rootlength  |noP      | 0.9640334| 0.1170907|     52|\n\n:::\n:::\n\n\n\n\n\n\n\nThe shapiro.test tests the NULL hypothesis that the samples came from a Normal distribution. This means that if your p-value <= 0.05, then you would reject the NULL hypothesis that the samples came from a normal distribution.\n\nFrom the output, the p-value < 0.05 for our complete dataset implies that the distribution of the data is significantly different from normal distribution. In other words, we can not assume the normality. However, we expect quite some differences dependent on the growth pattern and once we only look at our low P data we see that our indeed is normally distributed.\n\nNotice: Shapiro works only for sample sizes between 3-5000 numbers since when you feed it more data, the chances of the null hypothesis being rejected becomes larger. An alternative is the Anderson-Darling test that however has a similar problem with the Shapiro Wilk test. For large samples, you are most likely to reject the null hypothesis, so be aware of this.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nortest)\nad.test(noP_data$Rootlength)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAnderson-Darling normality test\n\ndata:  noP_data$Rootlength\nA = 0.58838, p-value = 0.1187\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n## ANOVA\n\nWhen we visualize the data, we see that there is a difference between the nutrient conditions but we want to know whether it is significant and more importantly, whether there is also a difference based on our treatments with different strains of microbes.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#lets visually compare our data with ggpubr again\nlibrary(\"ggpubr\")\n\nggboxplot(growth_data, x = \"Condition\", y = \"Rootlength\", color = \"Nutrient\",\n          palette = c(\"#00AFBB\", \"#E7B800\"))\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-32-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# We want to know whether root length depends on nutrient treatment\naov <- aov(Rootlength ~ Nutrient, data = growth_data)\nsummary(aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Df Sum Sq Mean Sq F value Pr(>F)    \nNutrient      1  651.8   651.8     425 <2e-16 ***\nResiduals   103  157.9     1.5                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\nHere, we see that there are significant differences based on our nutrient treatments. Now lets see how we can look at both the nutrient treatment and growth conditions.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# We want to know if root length depends on condition and nutrient\naov <- aov(Rootlength ~ Nutrient + Condition, data = growth_data)\nsummary(aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Df Sum Sq Mean Sq F value   Pr(>F)    \nNutrient      1  651.8   651.8  712.58  < 2e-16 ***\nCondition     3   66.5    22.2   24.23 7.27e-12 ***\nResiduals   100   91.5     0.9                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\nFrom the ANOVA table we can conclude that both nutrient condition and treatment are statistically significant. Nutrient treatment is the most significant factor variable. \n\nNot the above fitted model is called additive model. It makes an assumption that the two factor variables are independent. If you think that these two variables might interact to create an synergistic effect, replace the plus symbol (+) by an asterisk (*), as follows.\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Two-way ANOVA with interaction effect\n\n# These two calls are equivalent\naov <- aov(Rootlength ~ Nutrient * Condition, data = growth_data)\naov <- aov(Rootlength ~ Nutrient + Condition + Nutrient:Condition, data = growth_data)\n\n#summarize the aov\nsummary(aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                   Df Sum Sq Mean Sq F value   Pr(>F)    \nNutrient            1  651.8   651.8 817.131  < 2e-16 ***\nCondition           3   66.5    22.2  27.780 4.72e-13 ***\nNutrient:Condition  3   14.1     4.7   5.891 0.000976 ***\nResiduals          97   77.4     0.8                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\nIt can be seen that the two main effects (Nutrient and Condition) are statistically significant, as well as their interaction.\n\n**Note that, in the situation where the interaction is not significant you should use the additive model.**\n\n\n\n## TUKEY\n\nIn ANOVA test, a significant p-value indicates that some of the group means are different, but we don’t know which pairs of groups are different. It’s possible to perform multiple pairwise-comparison, to determine if the mean difference between specific pairs of group are statistically significant.\n\nAs the ANOVA test is significant, we can compute Tukey HSD (Tukey Honest Significant Differences). Tukey test is a single-step multiple comparison procedure and statistical test. It is a post-hoc analysis, what means that it is used in conjunction with an ANOVA.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#test with anova\naov <- aov(Rootlength ~ Nutrient * Condition, data = growth_data)\n\n#run tukey\nTukeyHSD(aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = Rootlength ~ Nutrient * Condition, data = growth_data)\n\n$Nutrient\n          diff      lwr      upr p adj\nP-noP 4.983086 4.637105 5.329067     0\n\n$Condition\n                          diff        lwr        upr     p adj\nStrain101-MgCl       2.1029052  1.4604930  2.7453173 0.0000000\nStrain230-MgCl       1.6836191  1.0341749  2.3330633 0.0000000\nStrain28-MgCl        1.2784796  0.6545138  1.9024455 0.0000034\nStrain230-Strain101 -0.4192861 -1.0864726  0.2479004 0.3597470\nStrain28-Strain101  -0.8244256 -1.4668377 -0.1820134 0.0061445\nStrain28-Strain230  -0.4051395 -1.0545837  0.2443048 0.3663501\n\n$`Nutrient:Condition`\n                                  diff        lwr        upr     p adj\nP:MgCl-noP:MgCl              4.0482585  2.9997859  5.0967311 0.0000000\nnoP:Strain101-noP:MgCl       1.2894180  0.2041458  2.3746903 0.0087961\nP:Strain101-noP:MgCl         6.9239348  5.8162834  8.0315861 0.0000000\nnoP:Strain230-noP:MgCl       1.3676850  0.2341551  2.5012149 0.0073003\nP:Strain230-noP:MgCl         6.0094793  4.9242070  7.0947515 0.0000000\nnoP:Strain28-noP:MgCl        0.3951101 -0.6533625  1.4435827 0.9391499\nP:Strain28-noP:MgCl          6.2021911  5.1169189  7.2874633 0.0000000\nnoP:Strain101-P:MgCl        -2.7588405 -3.8073131 -1.7103679 0.0000000\nP:Strain101-P:MgCl           2.8756763  1.8040558  3.9472967 0.0000000\nnoP:Strain230-P:MgCl        -2.6805735 -3.7789218 -1.5822252 0.0000000\nP:Strain230-P:MgCl           1.9612207  0.9127482  3.0096933 0.0000023\nnoP:Strain28-P:MgCl         -3.6531484 -4.6634819 -2.6428149 0.0000000\nP:Strain28-P:MgCl            2.1539326  1.1054600  3.2024052 0.0000002\nP:Strain101-noP:Strain101    5.6345168  4.5268654  6.7421681 0.0000000\nnoP:Strain230-noP:Strain101  0.0782670 -1.0552629  1.2117969 0.9999989\nP:Strain230-noP:Strain101    4.7200613  3.6347890  5.8053335 0.0000000\nnoP:Strain28-noP:Strain101  -0.8943079 -1.9427805  0.1541647 0.1537008\nP:Strain28-noP:Strain101     4.9127731  3.8275008  5.9980453 0.0000000\nnoP:Strain230-P:Strain101   -5.5562498 -6.7112241 -4.4012755 0.0000000\nP:Strain230-P:Strain101     -0.9144555 -2.0221069  0.1931958 0.1845494\nnoP:Strain28-P:Strain101    -6.5288247 -7.6004451 -5.4572042 0.0000000\nP:Strain28-P:Strain101      -0.7217437 -1.8293950  0.3859077 0.4749256\nP:Strain230-noP:Strain230    4.6417943  3.5082644  5.7753242 0.0000000\nnoP:Strain28-noP:Strain230  -0.9725749 -2.0709232  0.1257734 0.1223122\nP:Strain28-noP:Strain230     4.8345061  3.7009762  5.9680360 0.0000000\nnoP:Strain28-P:Strain230    -5.6143692 -6.6628417 -4.5658966 0.0000000\nP:Strain28-P:Strain230       0.1927118 -0.8925604  1.2779841 0.9993212\nP:Strain28-noP:Strain28      5.8070810  4.7586084  6.8555536 0.0000000\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nWe can see that most differences are significant, with the exception of Strain28, which in most cases does not show an effect.\n\nFor some representations it is useful to plot significant letters. We can do this using some extra packages as follows:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load library\nlibrary(agricolae)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'agricolae' was built under R version 4.4.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'agricolae'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:dlookr':\n\n    kurtosis, skewness\n```\n\n\n:::\n\n```{.r .cell-code}\n#separate nutrient conditions\nnoP_data <- growth_data[growth_data$Nutrient == \"noP\", ]\n\n#run an anova\naov_noP <- aov(Rootlength ~ Condition, data = noP_data)\n\n#run test\nHSD.test(aov_noP,\"Condition\", group=TRUE,console=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nStudy: aov_noP ~ \"Condition\"\n\nHSD Test for Rootlength \n\nMean Square Error:  0.606883 \n\nCondition,  means\n\n          Rootlength       std  r        se      Min      Max      Q25      Q50\nMgCl        5.805198 0.7738124 13 0.2160632 4.236348 6.834720 5.484364 5.743447\nStrain101   7.094616 0.5939804 13 0.2160632 5.947965 7.973207 6.717792 7.143667\nStrain230   7.172883 0.6117203 11 0.2348855 6.120089 8.197116 6.759308 7.166174\nStrain28    6.200309 0.9988989 15 0.2011439 4.384756 7.428674 5.349532 6.372659\n               Q75\nMgCl      6.424601\nStrain101 7.508370\nStrain230 7.590593\nStrain28  7.014785\n\nAlpha: 0.05 ; DF Error: 48 \nCritical Value of Studentized Range: 3.763749 \n\nGroups according to probability of means differences and alpha level( 0.05 )\n\nTreatments with the same letter are not significantly different.\n\n          Rootlength groups\nStrain230   7.172883      a\nStrain101   7.094616      a\nStrain28    6.200309      b\nMgCl        5.805198      b\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n## Check the homogeneity of variances\n\nThe residuals versus fits plot is used to check the homogeneity of variances. In the plot below, there is no evident relationships between residuals and fitted values (the mean of each groups), which is good. So, we can assume the homogeneity of variances. Only a few points (41, 58 and 77 are detected as outliers, which can severely  normality and homogeneity of variance. It can be useful to remove outliers to meet the test assumptions.)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#check for homogeneity\nplot(aov, 1)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-38-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\n#Use the Levene’s test to check the homogeneity of variances. \nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: carData\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'car'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    recode\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:purrr':\n\n    some\n```\n\n\n:::\n\n```{.r .cell-code}\nleveneTest(Rootlength ~ Nutrient * Condition, data = growth_data)\n```\n\n::: {.cell-output-display}\n\n|      | Df|  F value|    Pr(>F)|\n|:-----|--:|--------:|---------:|\n|group |  7| 1.862279| 0.0841169|\n|      | 97|       NA|        NA|\n\n:::\n:::\n\n\n\n\n\n\nFrom the output above we can see that the p-value is not less than the significance level of 0.05. This means that there is no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.\n\n\n## Check for normality v2\n\nNormality plot of the residuals. In the plot below, the quantiles of the residuals are plotted against the quantiles of the normal distribution. A 45-degree reference line is also plotted. The normal probability plot of residuals is used to verify the assumption that the residuals are normally distributed.\n\nThe normal probability plot of the residuals should approximately follow a straight line. which we can see below. Again, we see the points marked as potential outliers.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## plot\nplot(aov, 2)\n```\n\n::: {.cell-output-display}\n![](stats_files/figure-pdf/unnamed-chunk-39-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "stats_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}